<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">Cloudflare Turnstile的免费图形验证码怎么配置</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="188">下面按“<strong data-start="4" data-end="31">创建 Widget → 前端嵌入 → 后端校验</strong>”给你一套最常用的 Cloudflare Turnstile（免费）配置流程。先说明一下：<strong data-start="76" data-end="108">Turnstile 不是传统“选图/输字符”的图形验证码</strong>；Managed 模式最多让用户“勾选一下”，而且<strong data-start="133" data-end="149">不会出现图片或文字识别题</strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/concepts/widget/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/concepts/widget/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<hr data-start="190" data-end="193">
<h2 data-start="195" data-end="261">1) 在 Cloudflare 后台创建 Turnstile Widget（拿到 Site Key / Secret Key）</h2>
<ol data-start="263" data-end="844">
<li data-start="263" data-end="327">
<p data-start="266" data-end="327">登录 Cloudflare Dashboard → 左侧找到 <strong data-start="297" data-end="310">Turnstile</strong> → <strong data-start="313" data-end="327">Add widget</strong></p>
</li>
<li data-start="328" data-end="730">
<p data-start="331" data-end="333">填：</p>
<ul data-start="337" data-end="730">
<li data-start="337" data-end="372">
<p data-start="339" data-end="372"><strong data-start="339" data-end="354">Widget name</strong>：随便起（如 <code data-start="361" data-end="371">my-login</code>）</p>
</li>
<li data-start="376" data-end="456">
<p data-start="378" data-end="456"><strong data-start="378" data-end="391">Hostnames</strong>：把你要用的域名加进去（如 <code data-start="405" data-end="418">example.com</code>、<code data-start="419" data-end="436">www.example.com</code>，本地开发可加 <code data-start="444" data-end="455">localhost</code>）</p>
</li>
<li data-start="460" data-end="730">
<p data-start="462" data-end="476"><strong data-start="462" data-end="470">Mode</strong>（三选一）：</p>
<ul data-start="482" data-end="730">
<li data-start="482" data-end="569">
<p data-start="484" data-end="569"><strong data-start="484" data-end="499">Managed（推荐）</strong>：Cloudflare 自动决定是否需要交互（一般体验最好） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/concepts/widget/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/concepts/widget/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="575" data-end="654">
<p data-start="577" data-end="654"><strong data-start="577" data-end="596">Non-Interactive</strong>：用户看到一个加载组件，但不需要点选 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/concepts/widget/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/concepts/widget/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="660" data-end="730">
<p data-start="662" data-end="730"><strong data-start="662" data-end="675">Invisible</strong>：完全不显示组件（更“无感”） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/concepts/widget/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/concepts/widget/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
</ul>
</li>
</ul>
</li>
<li data-start="731" data-end="844">
<p data-start="734" data-end="749">Create 后你会得到一对：</p>
<ul data-start="753" data-end="844">
<li data-start="753" data-end="775">
<p data-start="755" data-end="775"><strong data-start="755" data-end="770">Sitekey（公钥）</strong>：给前端用</p>
</li>
<li data-start="779" data-end="844">
<p data-start="781" data-end="844"><strong data-start="781" data-end="799">Secret key（私钥）</strong>：给后端校验用 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 95px;"><a href="https://developers.cloudflare.com/turnstile/get-started/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 95px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
</li>
</ol>
<blockquote data-start="846" data-end="938">
<p data-start="848" data-end="938">注意：<strong data-start="851" data-end="885">每个 widget 默认至少要配置 1 个 hostname</strong>，否则创建不了或无法正常使用。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</blockquote>
<hr data-start="940" data-end="943">
<h2 data-start="945" data-end="972">2) 前端嵌入（最简单：Implicit 渲染）</h2>
<p data-start="974" data-end="994">把下面这段放到你的页面（通常是表单里）：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="996" data-end="1306"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">html</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-html"><span><span><span class="hljs-comment">&lt;!-- 1) 引入 Turnstile 脚本 --&gt;</span></span><span>
</span><span><span class="hljs-tag">&lt;<span class="hljs-name">script</span></span></span><span> </span><span><span class="hljs-attr">src</span></span><span>=</span><span><span class="hljs-string">"https://challenges.cloudflare.com/turnstile/v0/api.js"</span></span><span> </span><span><span class="hljs-attr">async</span></span><span> </span><span><span class="hljs-attr">defer</span></span><span>&gt;</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span></span></span><span>&gt;

</span><span><span class="hljs-tag">&lt;<span class="hljs-name">form</span></span></span><span> </span><span><span class="hljs-attr">method</span></span><span>=</span><span><span class="hljs-string">"POST"</span></span><span> </span><span><span class="hljs-attr">action</span></span><span>=</span><span><span class="hljs-string">"/login"</span></span><span>&gt;
  </span><span><span class="hljs-comment">&lt;!-- 2) 放一个容器（Turnstile 会自动渲染） --&gt;</span></span><span>
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span> </span><span><span class="hljs-attr">class</span></span><span>=</span><span><span class="hljs-string">"cf-turnstile"</span></span><span> </span><span><span class="hljs-attr">data-sitekey</span></span><span>=</span><span><span class="hljs-string">"你的SITE_KEY"</span></span><span>&gt;</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span></span></span><span>&gt;

  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><span> </span><span><span class="hljs-attr">type</span></span><span>=</span><span><span class="hljs-string">"submit"</span></span><span>&gt;提交</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span></span></span><span>&gt;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1308" data-end="1399">这就是官方推荐的最小用法：脚本 + <code data-start="1326" data-end="1340">cf-turnstile</code> 容器 + <code data-start="1346" data-end="1360">data-sitekey</code>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<h3 data-start="1401" data-end="1416">常用可选配置（按需加）</h3>
<ul data-start="1417" data-end="2060">
<li data-start="1417" data-end="1646">
<p data-start="1419" data-end="1512"><strong data-start="1419" data-end="1434">改 token 字段名</strong>（默认会自动注入隐藏字段 <code data-start="1447" data-end="1470">cf-turnstile-response</code>）： <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1515" data-end="1646"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">html</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-html"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span> </span><span><span class="hljs-attr">class</span></span><span>=</span><span><span class="hljs-string">"cf-turnstile"</span></span><span>
     </span><span><span class="hljs-attr">data-sitekey</span></span><span>=</span><span><span class="hljs-string">"你的SITE_KEY"</span></span><span>
     </span><span><span class="hljs-attr">data-response-field-name</span></span><span>=</span><span><span class="hljs-string">"turnstile-token"</span></span><span>&gt;</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span></span></span><span>&gt;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
</li>
<li data-start="1647" data-end="1821">
<p data-start="1649" data-end="1724"><strong data-start="1649" data-end="1664">区分场景 action</strong>（比如 login / signup）： <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1727" data-end="1821"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">html</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-html"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span> </span><span><span class="hljs-attr">class</span></span><span>=</span><span><span class="hljs-string">"cf-turnstile"</span></span><span> </span><span><span class="hljs-attr">data-sitekey</span></span><span>=</span><span><span class="hljs-string">"你的SITE_KEY"</span></span><span> </span><span><span class="hljs-attr">data-action</span></span><span>=</span><span><span class="hljs-string">"login"</span></span><span>&gt;</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span></span></span><span>&gt;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
</li>
<li data-start="1822" data-end="2060">
<p data-start="1824" data-end="1907"><strong data-start="1824" data-end="1833">尺寸/外观</strong>（仅 Managed / Non-Interactive 有意义）： <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 95px;"><a href="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 95px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1910" data-end="2060"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">html</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-html"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><span> </span><span><span class="hljs-attr">class</span></span><span>=</span><span><span class="hljs-string">"cf-turnstile"</span></span><span>
     </span><span><span class="hljs-attr">data-sitekey</span></span><span>=</span><span><span class="hljs-string">"你的SITE_KEY"</span></span><span>
     </span><span><span class="hljs-attr">data-size</span></span><span>=</span><span><span class="hljs-string">"compact"</span></span><span>
     </span><span><span class="hljs-attr">data-appearance</span></span><span>=</span><span><span class="hljs-string">"interaction-only"</span></span><span>&gt;</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span></span></span><span>&gt;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
</li>
</ul>
<hr data-start="2062" data-end="2065">
<h2 data-start="2067" data-end="2089">3) 后端必须做校验（否则等于没防护）</h2>
<p data-start="2091" data-end="2205"><strong data-start="2091" data-end="2105">只做前端展示不算完成</strong>：你必须在服务端调用 Siteverify API 校验 token。token <strong data-start="2146" data-end="2164">5 分钟过期、且只能校验一次</strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<h3 data-start="2207" data-end="2229">3.1 你后端从哪里拿 token？</h3>
<p data-start="2230" data-end="2341">如果你用的是上面的默认表单集成，Turnstile 会自动塞一个隐藏字段，默认名字是 <strong data-start="2273" data-end="2300"><code data-start="2275" data-end="2298">cf-turnstile-response</code></strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/client-side-rendering/widget-configurations/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<h3 data-start="2343" data-end="2369">3.2 用 curl 演示校验请求（最直观）</h3>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="2370" data-end="2525"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">bash</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-bash"><span><span>curl -X POST https://challenges.cloudflare.com/turnstile/v0/siteverify \
  -d </span><span><span class="hljs-string">"secret=你的SECRET_KEY"</span></span><span> \
  -d </span><span><span class="hljs-string">"response=表单里的cf-turnstile-response"</span></span><span>
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="2527" data-end="2606">校验接口与必填参数（<code data-start="2537" data-end="2545">secret</code>、<code data-start="2546" data-end="2556">response</code>）是官方定义的： <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<ul data-start="2607" data-end="2802">
<li data-start="2607" data-end="2724">
<p data-start="2609" data-end="2724">Endpoint：<code data-start="2618" data-end="2682">POST https://challenges.cloudflare.com/turnstile/v0/siteverify</code> <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="2725" data-end="2802">
<p data-start="2727" data-end="2802">参数：<code data-start="2730" data-end="2738">secret</code>（私钥）、<code data-start="2743" data-end="2753">response</code>（token） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
</ul>
<p data-start="2804" data-end="2897">你的后端逻辑就是：<strong data-start="2813" data-end="2856">只有当返回 JSON 的 <code data-start="2828" data-end="2843">success: true</code> 才允许登录/提交表单</strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<hr data-start="2899" data-end="2902">
<h2 data-start="2904" data-end="2931">4) 开发/自动化测试怎么搞（不想被验证码干扰）</h2>
<p data-start="2932" data-end="3088">Cloudflare 提供了<strong data-start="2946" data-end="2977">测试用的 dummy sitekey / secret</strong>，用于本地开发、E2E 自动化测试（例如 Selenium/Cypress/Playwright），避免被 Turnstile 当机器人拦掉。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/troubleshooting/testing/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/troubleshooting/testing/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<p data-start="3090" data-end="3095">例如：</p>
<ul data-start="3096" data-end="3277">
<li data-start="3096" data-end="3177">
<p data-start="3098" data-end="3177"><code data-start="3098" data-end="3124">1x00000000000000000000AA</code>（可见组件，永远通过） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/troubleshooting/testing/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/troubleshooting/testing/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="3178" data-end="3277">
<p data-start="3180" data-end="3277"><code data-start="3180" data-end="3217">1x0000000000000000000000000000000AA</code>（校验永远通过的测试 secret） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/troubleshooting/testing/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/troubleshooting/testing/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
</ul>
<hr data-start="3279" data-end="3282">
<h2 data-start="3284" data-end="3304">最容易踩坑的 3 件事（快速排查）</h2>
<ol data-start="3305" data-end="3549">
<li data-start="3305" data-end="3385">
<p data-start="3308" data-end="3385"><strong data-start="3308" data-end="3320">忘了做服务端校验</strong>（只嵌前端）：必须调用 siteverify。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="3386" data-end="3467">
<p data-start="3389" data-end="3467"><strong data-start="3389" data-end="3405">hostname 没配对</strong>：widget 只能在你授权的域名上用。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="3468" data-end="3549">
<p data-start="3471" data-end="3549"><strong data-start="3471" data-end="3488">token 过期/重复校验</strong>：token 5 分钟过期且单次使用。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/server-side-validation/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
</ol>
<hr data-start="3551" data-end="3554">
<p data-start="3556" data-end="3667">如果你告诉我你用的后端语言/框架（比如 Node/Express、Spring、Laravel、Django、Go 等）和你要保护的是<strong data-start="3623" data-end="3629">登录</strong>还是<strong data-start="3631" data-end="3640">评论/注册</strong>，我可以直接给你一份“可复制粘贴”的后端校验代码示例。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">我的网站是托管的，https://vercel.com/projects-9f/Todo，域名要填那个</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="221">你这个 <code data-start="4" data-end="50">https://vercel.com/projects-9f/Todo</code> <strong data-start="51" data-end="65">不是你网站的访问域名</strong>，它是 Vercel 的<strong data-start="77" data-end="87">项目后台页面</strong>（在 <code data-start="90" data-end="102">vercel.com</code> 上）。Turnstile 里“Hostnames/域名”要填的是：<strong data-start="136" data-end="182">用户实际打开你站点、加载验证码组件的那个域名（URL 里的 hostname 部分）</strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 95px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 95px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h2 data-start="223" data-end="232">你应该填什么</h2>
<ol data-start="233" data-end="262">
<li data-start="233" data-end="262">
<p data-start="236" data-end="262">先在浏览器里打开你真正的网站（通常是类似下面这种）：</p>
</li>
</ol>
<ul data-start="263" data-end="332">
<li data-start="263" data-end="289">
<p data-start="265" data-end="289"><code data-start="265" data-end="289">https://xxx.vercel.app</code></p>
</li>
<li data-start="290" data-end="332">
<p data-start="292" data-end="332">或你绑定的自定义域名 <code data-start="303" data-end="332">https://todo.yourdomain.com</code></p>
</li>
</ul>
<ol start="2" data-start="334" data-end="382">
<li data-start="334" data-end="382">
<p data-start="337" data-end="382">把 URL 里 <strong data-start="345" data-end="375"><code data-start="347" data-end="357">https://</code> 后面、第一个 <code data-start="365" data-end="368">/</code> 前面那段</strong>填进去，例如：</p>
</li>
</ol>
<ul data-start="383" data-end="575">
<li data-start="383" data-end="493">
<p data-start="385" data-end="493">访问地址：<code data-start="390" data-end="437">https://todo-jewels-projects-a09f.vercel.app/</code><br data-start="437" data-end="440">
✅ Hostname 填：<code data-start="455" data-end="493">todo-jewels-projects-a09f.vercel.app</code></p>
</li>
<li data-start="494" data-end="575">
<p data-start="496" data-end="575">访问地址：<code data-start="501" data-end="536">https://todo.yourdomain.com/login</code><br data-start="536" data-end="539">
✅ Hostname 填：<code data-start="554" data-end="575">todo.yourdomain.com</code></p>
</li>
</ul>
<blockquote data-start="577" data-end="708">
<p data-start="579" data-end="708">Turnstile Hostname <strong data-start="598" data-end="614">必须是纯域名（FQDN）</strong>，不能带 <code data-start="619" data-end="629">https://</code>、端口、路径；而且 <strong data-start="639" data-end="649">不支持通配符</strong>（不能填 <code data-start="654" data-end="668">*.vercel.app</code>）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</blockquote>
<h2 data-start="710" data-end="733">如果你还想让 Preview 部署也能用</h2>
<p data-start="734" data-end="817">Vercel 的 preview URL 往往每个部署都不一样（branch/commit 生成的域名），而 Turnstile 又<strong data-start="800" data-end="810">不能用通配符</strong>，所以你要么：</p>
<ul data-start="818" data-end="1032">
<li data-start="818" data-end="923">
<p data-start="820" data-end="923">把需要的 preview hostname <strong data-start="842" data-end="852">一个个加进去</strong>（免费版每个 widget 最多 15 个 hostname） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="924" data-end="1032">
<p data-start="926" data-end="1032">或者在 <strong data-start="930" data-end="970">preview / 测试环境改用 Cloudflare 官方测试 key</strong>（永远通过/便于自动化测试），不要用生产 key <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 95px;"><a href="https://developers.cloudflare.com/turnstile/troubleshooting/testing/?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/troubleshooting/testing/?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 95px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
<p data-start="1034" data-end="1101">如果你把“你的网站实际访问地址（vercel.app 那个链接或自定义域名）”贴出来，我可以直接告诉你应该填哪一条 hostname。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">我用的是supabase，要怎么填入Turnstile 的 Site Key 和 Secret Key</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="121">下面按 <strong data-start="4" data-end="106">Turnstile（Cloudflare）→ 域名怎么填（Vercel）→ Supabase 怎么填 Site Key / Secret Key → 前端怎么把 token 交给 Supabase</strong> 的顺序给你一套能跑通的配置。</p>
<h2 data-start="123" data-end="167">1) Cloudflare Turnstile：域名（Hostname）要填什么？</h2>
<p data-start="168" data-end="354">Turnstile 的 Hostname <strong data-start="189" data-end="206">必须是“纯域名/FQDN”</strong>，比如 <code data-start="210" data-end="223">example.com</code> 或 <code data-start="226" data-end="247">todo-xxx.vercel.app</code>，<strong data-start="248" data-end="255">不能带</strong> <code data-start="256" data-end="266">https://</code>、端口、路径（<code data-start="273" data-end="280">/Todo</code> 之类）——这些格式会被视为无效。也<strong data-start="298" data-end="308">不支持通配符</strong>，需要一个个加。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
<p data-start="356" data-end="446">你发的 <code data-start="360" data-end="406">https://vercel.com/jewels-projects-a09f/Todo</code> 是 <strong data-start="409" data-end="425">Vercel 控制台页面</strong>，不是你网站对外访问的域名，所以不要填它。</p>
<p data-start="448" data-end="470">✅ 你应该填的是你站点真正的访问域名，例如：</p>
<ul data-start="471" data-end="591">
<li data-start="471" data-end="554">
<p data-start="473" data-end="554">生产环境：<code data-start="478" data-end="496">你的项目名.vercel.app</code>（去 Vercel → Project → Deployments 里打开一次生产链接，看浏览器地址栏的 host）</p>
</li>
<li data-start="555" data-end="591">
<p data-start="557" data-end="591">如果你绑了自定义域名：<code data-start="568" data-end="584">yourdomain.com</code>（建议也加上）</p>
</li>
</ul>
<p data-start="593" data-end="644">（本地开发可额外加 <code data-start="603" data-end="614">localhost</code>，方便调试；但生产建议用单独的 widget 管理更清晰。）</p>
<h2 data-start="646" data-end="700">2) Supabase 里怎么填 Turnstile 的 Site Key / Secret Key？</h2>
<p data-start="701" data-end="989">Supabase 的“CAPTCHA Protection”配置里，<strong data-start="735" data-end="771">你只需要把 Turnstile 的 Secret Key 填进去</strong>：<br data-start="772" data-end="775">
Supabase Dashboard → <strong data-start="796" data-end="880">Settings → Authentication → Bot and Abuse Protection → Enable CAPTCHA protection</strong><br data-start="880" data-end="883">
选择 provider 为 <strong data-start="897" data-end="921">Cloudflare Turnstile</strong>，粘贴 <strong data-start="925" data-end="947">CAPTCHA Secret key</strong>，保存。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-captcha" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-captcha" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<p data-start="991" data-end="1193">为什么只填 Secret Key：Turnstile 的 <strong data-start="1020" data-end="1043">Sitekey 是给前端挂组件用的公钥</strong>，Secret key 是 <strong data-start="1057" data-end="1077">服务端校验 token 用的私钥</strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/get-started/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/get-started/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span><br data-start="1116" data-end="1119">
Supabase 会用你填的 Secret key 去帮你做校验，所以 Secret key 不需要放在 Vercel 前端环境变量里（也不该放）。</p>
<h2 data-start="1195" data-end="1227">3) Site Key 放哪？（你用 Vercel 托管）</h2>
<p data-start="1228" data-end="1280"><strong data-start="1228" data-end="1252">Site Key（sitekey）放前端</strong>，通常在 Vercel 环境变量里存一份公开变量，例如：</p>
<ul data-start="1281" data-end="1355">
<li data-start="1281" data-end="1355">
<p data-start="1283" data-end="1355"><code data-start="1283" data-end="1322">NEXT_PUBLIC_TURNSTILE_SITE_KEY=0x....</code>（名字你自定，但要 <code data-start="1332" data-end="1346">NEXT_PUBLIC_</code> 才能在前端读到）</p>
</li>
</ul>
<p data-start="1357" data-end="1439">然后在页面里渲染 Turnstile，拿到用户完成验证后的 token（通常叫 <code data-start="1397" data-end="1420">cf-turnstile-response</code> 或 callback token）。</p>
<h2 data-start="1441" data-end="1474">4) 前端拿到 token 后，怎么交给 Supabase？</h2>
<p data-start="1475" data-end="1529">关键点：<strong data-start="1479" data-end="1528">把 token 作为 <code data-start="1492" data-end="1506">captchaToken</code> 传给 Supabase Auth 接口</strong>。</p>
<ul data-start="1531" data-end="1603">
<li data-start="1531" data-end="1603">
<p data-start="1533" data-end="1603">注册（signUp）示例（Supabase 文档就是这么用的）： <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-captcha" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-captcha" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
</li>
</ul>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1604" data-end="1695"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">signUp</span></span><span>({
  email,
  password,
  </span><span><span class="hljs-attr">options</span></span><span>: { captchaToken },
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<ul data-start="1697" data-end="1844">
<li data-start="1697" data-end="1844">
<p data-start="1699" data-end="1844">登录（signInWithPassword）：Supabase 官方 JS API 页面示例没写 captcha，但 Supabase 维护者给出的用法是同样放在 <code data-start="1781" data-end="1803">options.captchaToken</code> 里： <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 45px;"><a href="https://github.com/orgs/supabase/discussions/30668?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://github.com/orgs/supabase/discussions/30668?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 45px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">GitHub</span></span></span></a></span></span></p>
</li>
</ul>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1845" data-end="1948"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">signInWithPassword</span></span><span>({
  email,
  password,
  </span><span><span class="hljs-attr">options</span></span><span>: { captchaToken },
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1950" data-end="2053">（另外像匿名登录 <code data-start="1959" data-end="1978">signInAnonymously</code>，官方 JS 文档明确支持 <code data-start="1992" data-end="2014">options.captchaToken</code>：<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/reference/javascript/auth-signinanonymously" target="_blank" rel="noopener" alt="https://supabase.com/docs/reference/javascript/auth-signinanonymously" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span>）</p>
<hr data-start="2055" data-end="2058">
<h3 data-start="2060" data-end="2076">常见坑（你很可能会遇到）</h3>
<ul data-start="2077" data-end="2347">
<li data-start="2077" data-end="2178">
<p data-start="2079" data-end="2178"><strong data-start="2079" data-end="2087">域名填错</strong>：填了 <code data-start="2091" data-end="2104">https://...</code> 或带路径 <code data-start="2110" data-end="2117">/Todo</code> → Turnstile 直接判无效域名。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
<li data-start="2179" data-end="2222">
<p data-start="2181" data-end="2222"><strong data-start="2181" data-end="2200">填了 Vercel 控制台域名</strong>：<code data-start="2201" data-end="2213">vercel.com</code> 不是你站点域名。</p>
</li>
<li data-start="2223" data-end="2347">
<p data-start="2225" data-end="2347"><strong data-start="2225" data-end="2247">预览部署（Preview）域名一直变</strong>：Turnstile 不支持通配符 hostnames，预览域名要么不启用/用测试 key，要么只在生产域名启用（更省事）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" target="_blank" rel="noopener" alt="https://developers.cloudflare.com/turnstile/additional-configuration/hostname-management/" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Cloudflare Docs</span></span></span></a></span></span></p>
</li>
</ul>
<p data-start="2349" data-end="2450">如果你把你“真实可访问的站点 URL”（浏览器地址栏那种）贴出来（例如 <code data-start="2385" data-end="2401">xxx.vercel.app</code> 或你的自定义域名），我可以直接告诉你 Turnstile 里 Hostname 精确该填哪几个。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">怎么在 Supabase 配置 OTP 验证码</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="132">在 Supabase 里“OTP 验证码”通常有三种意思：<strong data-start="29" data-end="48">邮件 OTP（输入验证码登录）</strong>、<strong data-start="49" data-end="59">短信 OTP</strong>、以及 <strong data-start="63" data-end="104">MFA 的 TOTP（Authenticator App 那种 6 位码）</strong>。我把三种都给你按「后台怎么配 + 前端怎么用」说清楚。</p>
<h2 data-start="134" data-end="172">A) 邮件 OTP（让用户输入验证码，而不是点 Magic Link）</h2>
<p data-start="173" data-end="328">Supabase 的 <code data-start="184" data-end="201">signInWithOtp()</code> <strong data-start="202" data-end="222">默认发的是 Magic Link</strong>；是否变成“验证码邮件”，取决于你邮件模板里用的是 <code data-start="248" data-end="272">{{ .ConfirmationURL }}</code> 还是 <code data-start="276" data-end="290">{{ .Token }}</code>。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-passwordless" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-passwordless" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h3 data-start="330" data-end="349">1) Dashboard 配置</h3>
<ol data-start="350" data-end="920">
<li data-start="350" data-end="476">
<p data-start="353" data-end="476">Supabase Dashboard → <strong data-start="374" data-end="392">Authentication</strong> 里找到 <strong data-start="397" data-end="428">Email Templates / Templates</strong>（邮件模板入口）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/general-configuration" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/general-configuration" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
<li data-start="477" data-end="665">
<p data-start="480" data-end="542">编辑用于密码less登录的邮件模板（通常是 <em data-start="502" data-end="514">Magic link</em> 那个模板），把正文里用于链接的变量换成验证码变量：</p>
<ul data-start="546" data-end="665">
<li data-start="546" data-end="579">
<p data-start="548" data-end="579">用 <code data-start="550" data-end="564">{{ .Token }}</code> ⇒ 发送 OTP 验证码</p>
</li>
<li data-start="583" data-end="665">
<p data-start="585" data-end="665">用 <code data-start="587" data-end="611">{{ .ConfirmationURL }}</code> ⇒ 发送 Magic Link <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/reference/javascript/auth-signinwithotp" target="_blank" rel="noopener" alt="https://supabase.com/docs/reference/javascript/auth-signinwithotp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
</li>
<li data-start="666" data-end="835">
<p data-start="669" data-end="835">（推荐）设置 OTP 过期时间：<strong data-start="685" data-end="736">Auth &gt; Providers &gt; Email &gt; Email OTP Expiration</strong>。默认 OTP <strong data-start="744" data-end="754">1 小时过期</strong>，并且<strong data-start="757" data-end="772">60 秒内只能请求一次</strong>；有效期不能超过 <strong data-start="781" data-end="797">86400 秒（1 天）</strong>。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-passwordless" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-passwordless" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
<li data-start="836" data-end="920">
<p data-start="839" data-end="920">（强烈建议上生产必做）配置 <strong data-start="853" data-end="868">Custom SMTP</strong>，否则投递/进垃圾箱会很痛苦。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-smtp?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-smtp?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ol>
<h3 data-start="922" data-end="946">2) 前端调用（supabase-js）</h3>
<p data-start="947" data-end="953">发送验证码：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="954" data-end="1068"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">signInWithOtp</span></span><span>({
  email,
  </span><span><span class="hljs-attr">options</span></span><span>: { </span><span><span class="hljs-attr">shouldCreateUser</span></span><span>: </span><span><span class="hljs-literal">true</span></span><span> }, </span><span><span class="hljs-comment">// 不想自动注册就改 false</span></span><span>
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1069" data-end="1083">用户输入验证码后校验并登录：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1084" data-end="1209"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">verifyOtp</span></span><span>({
  email,
  </span><span><span class="hljs-attr">token</span></span><span>: code,      </span><span><span class="hljs-comment">// 用户输入的验证码</span></span><span>
  </span><span><span class="hljs-attr">type</span></span><span>: </span><span><span class="hljs-string">'email'</span></span><span>,    </span><span><span class="hljs-comment">// 邮箱 OTP 用 'email'</span></span><span>
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1210" data-end="1327"><code data-start="1210" data-end="1221">verifyOtp</code> 的 email 类型现在推荐用 <code data-start="1238" data-end="1245">email</code>（旧的 <code data-start="1249" data-end="1257">signup</code> / <code data-start="1260" data-end="1271">magiclink</code> 类型已标注 deprecated）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/reference/javascript/auth-verifyotp" target="_blank" rel="noopener" alt="https://supabase.com/docs/reference/javascript/auth-verifyotp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<hr data-start="1329" data-end="1332">
<h2 data-start="1334" data-end="1356">B) 短信 OTP（手机收 6 位码）</h2>
<h3 data-start="1357" data-end="1376">1) Dashboard 配置</h3>
<ol data-start="1377" data-end="1543">
<li data-start="1377" data-end="1433">
<p data-start="1380" data-end="1433">Supabase Dashboard → <strong data-start="1401" data-end="1431">Authentication → Providers</strong></p>
</li>
<li data-start="1434" data-end="1543">
<p data-start="1437" data-end="1543"><strong data-start="1437" data-end="1458">启用 Phone provider</strong>，并选择/配置 SMS Provider（例如 Twilio Verify 等），填对应的凭证。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/phone-login?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/phone-login?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ol>
<h3 data-start="1545" data-end="1556">2) 前端调用</h3>
<p data-start="1557" data-end="1563">发送短信码：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1564" data-end="1636"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">signInWithOtp</span></span><span>({ </span><span><span class="hljs-attr">phone</span></span><span>: </span><span><span class="hljs-string">'+8613xxxxxxxxx'</span></span><span> })
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1637" data-end="1643">校验短信码：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1644" data-end="1754"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">verifyOtp</span></span><span>({
  </span><span><span class="hljs-attr">phone</span></span><span>: </span><span><span class="hljs-string">'+8613xxxxxxxxx'</span></span><span>,
  </span><span><span class="hljs-attr">token</span></span><span>: code,   </span><span><span class="hljs-comment">// 6 位</span></span><span>
  </span><span><span class="hljs-attr">type</span></span><span>: </span><span><span class="hljs-string">'sms'</span></span><span>,
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1755" data-end="1837">短信 OTP 是 <strong data-start="1764" data-end="1772">6 位码</strong>，并且需要在 <strong data-start="1779" data-end="1790">60 秒内验证</strong>（官方文档这么写）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/phone-login" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/phone-login" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<hr data-start="1839" data-end="1842">
<h2 data-start="1844" data-end="1897">C) MFA 的 TOTP（Google Authenticator / 1Password 那种）</h2>
<p data-start="1898" data-end="2030">如果你说的“OTP”是 <strong data-start="1910" data-end="1931">登录后还要再输一次动态码（2FA）</strong>，那是 Supabase 的 <strong data-start="1946" data-end="1960">MFA (TOTP)</strong>，默认项目就能用（不等同于上面 A/B 的“免密登录 OTP”）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-mfa/totp?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-mfa/totp?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<p data-start="2032" data-end="2146">最简流程是：<code data-start="2038" data-end="2048">enroll()</code> 生成二维码 → 用户扫码 → <code data-start="2064" data-end="2077">challenge()</code> → <code data-start="2080" data-end="2090">verify()</code> 输入 App 里 6 位码完成绑定。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/reference/javascript/auth-mfa-enroll?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/reference/javascript/auth-mfa-enroll?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<hr data-start="2148" data-end="2151">
<p data-start="2153" data-end="2290">如果你告诉我你要做的是 <strong data-start="2165" data-end="2182">(1) 邮件输入验证码登录</strong> 还是 <strong data-start="2186" data-end="2200">(2) 手机短信登录</strong> 还是 <strong data-start="2204" data-end="2219">(3) 登录后 2FA</strong>，以及你前端用的是 Next.js 还是纯 HTML，我可以按你项目结构给你一套“可直接粘贴”的页面代码（含验证码输入框、倒计时、错误提示）。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">Vercel Edge Functions + Resend 实现：

用户输入邮箱 → 前端调用 Vercel API
Vercel API 生成 6 位验证码，存入 Supabase 临时表
通过 Resend 发送验证码邮件
用户输入验证码 → 前端调用 API 验证
验证通过后完成注册
-------------------
上面这个方案可行吗，vercel是否提供这样的免费功能？</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="121">可行，而且<strong data-start="5" data-end="71">Vercel（免费 Hobby）确实能跑 Edge Functions + 调外部 API（Resend、Supabase）</strong>。但要注意：<strong data-start="77" data-end="91">免费不是“无限免费”</strong>，是“<strong data-start="94" data-end="104">有额度的免费</strong>”，超过后一般要升级/等下月重置。</p>
<h2 data-start="123" data-end="137">这个方案技术上可行吗？</h2>
<p data-start="138" data-end="149">可行。你的流程本质是：</p>
<ol data-start="151" data-end="342">
<li data-start="151" data-end="189">
<p data-start="154" data-end="189">前端 → 调用 Vercel API（Edge Function）</p>
</li>
<li data-start="190" data-end="246">
<p data-start="193" data-end="246">Edge Function 生成 6 位码（用 Web Crypto），写入 Supabase 临时表</p>
</li>
<li data-start="247" data-end="278">
<p data-start="250" data-end="278">Edge Function 调 Resend 发邮件</p>
</li>
<li data-start="279" data-end="310">
<p data-start="282" data-end="310">前端输入验证码 → 再调 Vercel API 校验</p>
</li>
<li data-start="311" data-end="342">
<p data-start="314" data-end="342">校验通过 → 在 Supabase 创建用户/写用户资料</p>
</li>
</ol>
<p data-start="344" data-end="402">这类“验证码发放/校验”属于典型的无状态 API 工作流，Edge Runtime 很适合（网络请求为主，延迟低）。</p>
<h2 data-start="404" data-end="428">Vercel 是否提供“这样的免费功能”？</h2>
<p data-start="429" data-end="678">提供：<strong data-start="432" data-end="471">Vercel Hobby 计划包含 Edge Requests 等额度</strong>，你可以免费部署并对外提供 API（Edge Functions / Functions）。Vercel 定价页显示 Hobby <strong data-start="536" data-end="558">Edge Requests 1M/月</strong>、Fast Data Transfer <strong data-start="578" data-end="589">100GB/月</strong>（Pro 是 10M/月、1TB/月，超额按量计费从 $2/1M Edge Requests 等开始）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 41px;"><a href="https://vercel.com/pricing?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://vercel.com/pricing?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 41px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Vercel</span></span></span></a></span></span></p>
<p data-start="680" data-end="781">另外，Edge Runtime 有运行约束（比如必须在一定时间内开始响应、流式响应上限等），Vercel 的函数限制文档有说明。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 41px;"><a href="https://vercel.com/docs/functions/limitations" target="_blank" rel="noopener" alt="https://vercel.com/docs/functions/limitations" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 41px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Vercel</span></span></span></a></span></span></p>
<p data-start="783" data-end="925">如果你担心被刷接口，Vercel 现在也把 <strong data-start="805" data-end="832">Rate Limiting 放进了 Hobby</strong>：每个项目 1 条免费规则，并且有“每月前 1,000,000 次允许的 rate limit 请求”包含额度。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 41px;"><a href="https://vercel.com/changelog/rate-limiting-now-available-on-hobby-with-higher-included-usage-on-pro?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://vercel.com/changelog/rate-limiting-now-available-on-hobby-with-higher-included-usage-on-pro?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 41px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Vercel</span></span></span></a></span></span></p>
<h2 data-start="927" data-end="943">Resend 免费够用吗？</h2>
<p data-start="944" data-end="1093">Resend 免费账户配额是 <strong data-start="959" data-end="979">100 封/天、3000 封/月</strong>（收件/发件都计入），并且有默认速率限制（比如 2 req/s 起步）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/knowledge-base/resend-email-quota" target="_blank" rel="noopener" alt="https://resend.com/docs/knowledge-base/resend-email-quota" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span><br data-start="1052" data-end="1055">
所以如果你验证码邮件量上来（尤其被薅羊毛），Resend 往往会先成为瓶颈。</p>
<h2 data-start="1095" data-end="1122">你这个自建 OTP 方案最大的风险点（务必补齐）</h2>
<p data-start="1123" data-end="1144">为了防刷/防爆破/防撞库，建议至少做这些：</p>
<ul data-start="1146" data-end="1535">
<li data-start="1146" data-end="1219">
<p data-start="1148" data-end="1219"><strong data-start="1148" data-end="1160">验证码不要明文存</strong>：存 <code data-start="1163" data-end="1174">code_hash</code>（比如 SHA-256 + per-record salt），校验时 hash 后对比</p>
</li>
<li data-start="1220" data-end="1264">
<p data-start="1222" data-end="1264"><strong data-start="1222" data-end="1229">短过期</strong>：建议 5–10 分钟；并且<strong data-start="1243" data-end="1252">一次性使用</strong>（验证成功立刻作废）</p>
</li>
<li data-start="1265" data-end="1314">
<p data-start="1267" data-end="1314"><strong data-start="1267" data-end="1277">限制尝试次数</strong>：同一个 email/同一个 code 例如 5 次失败就锁定一段时间</p>
</li>
<li data-start="1315" data-end="1439">
<p data-start="1317" data-end="1439"><strong data-start="1317" data-end="1329">限频（非常关键）</strong>：同一 email、同一 IP、同一 UA 都要限频（你可以用 Vercel Rate Limiting + Supabase 侧记录做双层）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 41px;"><a href="https://vercel.com/changelog/rate-limiting-now-available-on-hobby-with-higher-included-usage-on-pro?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://vercel.com/changelog/rate-limiting-now-available-on-hobby-with-higher-included-usage-on-pro?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 41px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Vercel</span></span></span></a></span></span></p>
</li>
<li data-start="1440" data-end="1483">
<p data-start="1442" data-end="1483"><strong data-start="1442" data-end="1463">接口返回不要泄露“该邮箱是否存在”</strong>（统一返回“已发送/如存在将发送”）</p>
</li>
<li data-start="1484" data-end="1535">
<p data-start="1486" data-end="1535"><strong data-start="1486" data-end="1505">Supabase 表的 RLS</strong>：临时表只允许服务端（Vercel）写读；客户端不要直连读写</p>
</li>
</ul>
<h2 data-start="1537" data-end="1571">更省事的替代：其实 Supabase 自带 Email OTP</h2>
<p data-start="1572" data-end="1852">如果你的目标只是“邮箱验证码登录/注册”，Supabase 自带 OTP：<code data-start="1609" data-end="1624">signInWithOtp</code> + <code data-start="1627" data-end="1638">verifyOtp</code>，并且默认就做了<strong data-start="1646" data-end="1667">60 秒一次请求限制、1 小时过期</strong>（可在面板配置，且最长不允许超过 86400 秒以降低暴力破解风险）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-email-passwordless" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-passwordless" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span><br data-start="1739" data-end="1742">
把邮件模板从 <code data-start="1749" data-end="1773">{{ .ConfirmationURL }}</code> 改为 <code data-start="1777" data-end="1791">{{ .Token }}</code> 就会发“验证码”而不是 magic link。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-passwordless" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-passwordless" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<p data-start="1854" data-end="1920">如果你不是强需求（必须用 Resend、必须自定义流程），<strong data-start="1883" data-end="1906">优先用 Supabase 内置 OTP</strong>，成本/安全/维护都会更轻。</p>
<hr data-start="1922" data-end="1925">
<p data-start="1927" data-end="2186">结论：<strong data-start="1930" data-end="1973">你的方案在 Vercel + Supabase + Resend 上完全能落地</strong>，并且“免费可跑”——但免费有额度（Vercel 有 Edge Requests/流量额度；Resend 有 100/天、3000/月额度）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 56px;"><a href="https://vercel.com/pricing?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://vercel.com/pricing?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 56px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Vercel</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span><br data-start="2081" data-end="2084">
如果你愿意我给你一份“可直接用”的表结构（含索引/TTL清理）+ 两个 Vercel Edge API（send-code / verify-code）伪代码骨架，把上面限频/哈希/一次性消费都内置进去。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">resend好像有SMTP功能</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="90">对，<strong data-start="2" data-end="25">Resend 有 SMTP Relay</strong>，可以当作 SMTP 服务用（不止 HTTP API）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/pricing" target="_blank" rel="noopener" alt="https://resend.com/pricing" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h2 data-start="92" data-end="116">Resend SMTP 的连接参数（官方）</h2>
<ul data-start="117" data-end="477">
<li data-start="117" data-end="185">
<p data-start="119" data-end="185"><strong data-start="119" data-end="127">Host</strong>：<code data-start="128" data-end="145">smtp.resend.com</code> <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="186" data-end="313">
<p data-start="188" data-end="313"><strong data-start="188" data-end="196">Port</strong>：<code data-start="197" data-end="210">465/587/...</code>（官方列了 25、465、587、2465、2587；465/2465 是 SMTPS，587/2587 是 STARTTLS）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="314" data-end="377">
<p data-start="316" data-end="377"><strong data-start="316" data-end="328">Username</strong>：<code data-start="329" data-end="337">resend</code> <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="378" data-end="477">
<p data-start="380" data-end="477"><strong data-start="380" data-end="392">Password</strong>：你的 <strong data-start="396" data-end="414">Resend API Key</strong>（直接把 API Key 当 SMTP 密码用）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/docs/send-with-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
<blockquote data-start="479" data-end="550">
<p data-start="481" data-end="550">Resend 也明确：发 SMTP 的速率限制跟 API 一样。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</blockquote>
<h2 data-start="552" data-end="617">你用 Supabase 的话：最推荐的用法 = “Supabase Custom SMTP → 填 Resend SMTP”</h2>
<p data-start="618" data-end="823">Supabase 官方文档明确支持自定义 SMTP，并且点名 <strong data-start="649" data-end="662">Resend 可用</strong>；还提醒默认 SMTP 非生产用途、额度很低（示例写“当前 2 封/小时”且可能变）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-smtp" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span><br data-start="742" data-end="745">
Resend 也有专门的“Supabase + Resend SMTP”集成指引。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
<p data-start="825" data-end="846">在 Supabase Dashboard：</p>
<ol data-start="847" data-end="1265">
<li data-start="847" data-end="913">
<p data-start="850" data-end="913">Project Settings / Authentication（具体入口按你面板版本）→ 找到 <strong data-start="900" data-end="908">SMTP</strong> 区域</p>
</li>
<li data-start="914" data-end="944">
<p data-start="917" data-end="944">打开 <strong data-start="920" data-end="942">Enable Custom SMTP</strong></p>
</li>
<li data-start="945" data-end="1265">
<p data-start="948" data-end="966">填（按 Resend 文档推荐值）：</p>
<ul data-start="970" data-end="1265">
<li data-start="970" data-end="999">
<p data-start="972" data-end="999">SMTP Host：<code data-start="982" data-end="999">smtp.resend.com</code></p>
</li>
<li data-start="1003" data-end="1088">
<p data-start="1005" data-end="1088">SMTP Port：<code data-start="1015" data-end="1020">465</code>（Resend 给 Supabase 的示例就是 465）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="1092" data-end="1112">
<p data-start="1094" data-end="1112">SMTP User：<code data-start="1104" data-end="1112">resend</code></p>
</li>
<li data-start="1116" data-end="1145">
<p data-start="1118" data-end="1145">SMTP Pass：你的 Resend API Key</p>
</li>
<li data-start="1149" data-end="1265">
<p data-start="1151" data-end="1265">Sender email / name：用你在 Resend <strong data-start="1182" data-end="1191">已验证域名</strong>下的发件人地址（例如 <code data-start="1202" data-end="1227">no-reply@yourdomain.com</code>）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
</li>
</ol>
<p data-start="1267" data-end="1348">这样做的好处：<strong data-start="1274" data-end="1315">Supabase 的注册/登录/OTP/重置密码邮件都由 Resend 发</strong>，你就不一定需要自己在 Vercel 写“发验证码邮件”的逻辑了。</p>
<h2 data-start="1350" data-end="1365">免费是否支持 SMTP？</h2>
<p data-start="1366" data-end="1482">支持。Resend 定价页在 Free 档里列了 <strong data-start="1391" data-end="1405">SMTP Relay</strong>，并且 <strong data-start="1409" data-end="1430">Daily limit = 100</strong>（每天最多 100 封）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/pricing" target="_blank" rel="noopener" alt="https://resend.com/pricing" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
<h2 data-start="1484" data-end="1533">你当前“Vercel Edge Functions + Resend SMTP”要注意的一点</h2>
<p data-start="1534" data-end="1653">如果你打算在 <strong data-start="1541" data-end="1576">Vercel Edge Functions 里直接走 SMTP</strong>：Edge Runtime 通常只有 <code data-start="1595" data-end="1602">fetch</code> 这类 Web API，<strong data-start="1614" data-end="1645">不适合/往往不能直接建立 SMTP 这种 TCP 连接</strong>。更稳的做法是：</p>
<ul data-start="1654" data-end="1790">
<li data-start="1654" data-end="1702">
<p data-start="1656" data-end="1702">在 Edge Functions 里继续用 <strong data-start="1678" data-end="1697">Resend HTTP API</strong> 发信；或</p>
</li>
<li data-start="1703" data-end="1790">
<p data-start="1705" data-end="1790">改用 Vercel 的 <strong data-start="1717" data-end="1748">Node.js Serverless Function</strong>（再用 SMTP/Nodemailer），但这也要看平台对外连 TCP 端口的限制。</p>
</li>
</ul>
<p data-start="1792" data-end="1922">如果你告诉我你现在的 Next.js 路由是 <code data-start="1815" data-end="1837">app/api/.../route.ts</code>（Edge）还是 <code data-start="1846" data-end="1861">pages/api/...</code>（Node），我可以直接给你一份最合适的发信实现方式（API 版或 SMTP 版）和 Supabase OTP 对接方式。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">具体Supabase要怎么配置</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="127">可以。你要在 <strong data-start="7" data-end="19">Supabase</strong> 里做两块配置：<strong data-start="27" data-end="64">(1) 用 Resend 当 Supabase 的 SMTP 发信</strong>，<strong data-start="65" data-end="106">(2) 把“Magic Link 邮件”改成“6 位 OTP 验证码邮件”</strong>（以及 OTP 过期时间/URL 配置）。</p>
<hr data-start="129" data-end="132">
<h2 data-start="134" data-end="179">1) Supabase 用 Resend SMTP 发邮件（Custom SMTP）</h2>
<h3 data-start="181" data-end="195">Resend 侧准备</h3>
<ul data-start="196" data-end="306">
<li data-start="196" data-end="306">
<p data-start="198" data-end="306">在 Resend：创建 <strong data-start="210" data-end="221">API Key</strong>、并 <strong data-start="224" data-end="236">验证你的发信域名</strong>（Resend 的 Supabase 指南把这两项作为前置条件）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
<h3 data-start="308" data-end="335">Supabase 侧填写（Dashboard）</h3>
<p data-start="336" data-end="404">按 Resend 官方给 Supabase 的步骤走即可：<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
<ol data-start="405" data-end="952">
<li data-start="405" data-end="431">
<p data-start="408" data-end="431">进入你的 Supabase Project</p>
</li>
<li data-start="432" data-end="481">
<p data-start="435" data-end="481">左侧 <strong data-start="438" data-end="458">Project Settings</strong> → <strong data-start="461" data-end="479">Authentication</strong></p>
</li>
<li data-start="482" data-end="527">
<p data-start="485" data-end="527">找到 <strong data-start="488" data-end="496">SMTP</strong> 区域，打开 <strong data-start="503" data-end="525">Enable Custom SMTP</strong></p>
</li>
<li data-start="528" data-end="852">
<p data-start="531" data-end="602">填 Resend SMTP 参数（Resend 官方参数如下）：<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<ul data-start="606" data-end="852">
<li data-start="606" data-end="636">
<p data-start="608" data-end="636"><strong data-start="608" data-end="616">Host</strong>：<code data-start="617" data-end="634">smtp.resend.com</code></p>
</li>
<li data-start="640" data-end="722">
<p data-start="642" data-end="722"><strong data-start="642" data-end="650">Port</strong>：<code data-start="651" data-end="656">465</code>（Resend 的 Supabase 指南用 465）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="726" data-end="751">
<p data-start="728" data-end="751"><strong data-start="728" data-end="740">Username</strong>：<code data-start="741" data-end="749">resend</code></p>
</li>
<li data-start="755" data-end="852">
<p data-start="757" data-end="852"><strong data-start="757" data-end="769">Password</strong>：你的 Resend <strong data-start="780" data-end="791">API Key</strong>（把 API Key 当 SMTP 密码用）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/docs/send-with-smtp?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
</li>
<li data-start="853" data-end="952">
<p data-start="856" data-end="952">填 <strong data-start="858" data-end="874">Sender email</strong> 和 <strong data-start="877" data-end="892">Sender name</strong>（这两项在 Supabase 里是必填）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-supabase-smtp" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-supabase-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ol>
<blockquote data-start="954" data-end="1049">
<p data-start="956" data-end="1049">Supabase 文档也说明：Supabase Auth 可接任何 SMTP 服务，Resend 在支持列表里。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-smtp" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-smtp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
</blockquote>
<hr data-start="1051" data-end="1054">
<h2 data-start="1056" data-end="1097">2) 让 Supabase 发送“6 位验证码”而不是 Magic Link</h2>
<p data-start="1099" data-end="1253">Supabase 的 <code data-start="1110" data-end="1127">signInWithOtp()</code> <strong data-start="1128" data-end="1148">默认发的是 Magic Link</strong>；要变成 OTP，只需改邮件模板：把模板里常见的 <code data-start="1173" data-end="1197">{{ .ConfirmationURL }}</code> 换成 <code data-start="1201" data-end="1215">{{ .Token }}</code>。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h3 data-start="1255" data-end="1283">在 Supabase Dashboard 改模板</h3>
<ul data-start="1284" data-end="1386">
<li data-start="1284" data-end="1340">
<p data-start="1286" data-end="1340">进入 <strong data-start="1289" data-end="1338">Authentication → Email Templates（或 Templates）</strong></p>
</li>
<li data-start="1341" data-end="1386">
<p data-start="1343" data-end="1386">找到用于 passwordless/magic link 的那封邮件，把正文改成类似：</p>
</li>
</ul>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1388" data-end="1454"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">html</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-html"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">p</span></span></span><span>&gt;你的验证码是：</span><span><span class="hljs-tag">&lt;<span class="hljs-name">b</span></span></span><span>&gt;{{ .Token }}</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span></span></span><span>&gt;</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;<span class="hljs-name">p</span></span></span><span>&gt;验证码 10 分钟内有效。</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span></span></span><span>&gt;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1456" data-end="1543">Supabase 官方文档明确写了：用 <code data-start="1476" data-end="1490">{{ .Token }}</code> 就是 “email OTP”。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<hr data-start="1545" data-end="1548">
<h2 data-start="1550" data-end="1572">3) 配置 OTP 有效期（建议必改）</h2>
<p data-start="1573" data-end="1790">Supabase 默认：<strong data-start="1585" data-end="1600">60 秒内只能请求一次</strong>，OTP <strong data-start="1605" data-end="1615">1 小时过期</strong>；可以在面板调整，但最长不允许超过 <strong data-start="1633" data-end="1649">86400 秒（1 天）</strong>。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-passwordless?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-passwordless?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span><br data-start="1687" data-end="1690">
路径（文档口径）：<strong data-start="1699" data-end="1750">Auth → Providers → Email → Email OTP Expiration</strong>。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-email-passwordless?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-passwordless?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<p data-start="1792" data-end="1820">建议你设：<strong data-start="1797" data-end="1819">300–600 秒（5–10 分钟）</strong>。</p>
<hr data-start="1822" data-end="1825">
<h2 data-start="1827" data-end="1866">4) URL Configuration（Vercel 部署建议也配好）</h2>
<p data-start="1867" data-end="2084">即便你用“输入验证码”的方式（不点链接），很多流程（邮箱确认、重置密码等）还是会用到 <strong data-start="1910" data-end="1938">Site URL / Redirect URLs</strong>。Supabase 的 Redirect URL 配置在 <strong data-start="1967" data-end="2005">Authentication → URL Configuration</strong>，并且支持为 Vercel 预览域名加通配符（开发用），生产建议用精确 URL。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/redirect-urls" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/redirect-urls" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<hr data-start="2086" data-end="2089">
<h2 data-start="2091" data-end="2116">5) 前端调用方式（你就不需要自建临时表了）</h2>
<p data-start="2117" data-end="2211">发送验证码（不存在的邮箱默认会自动创建用户，想禁止可设 <code data-start="2145" data-end="2170">shouldCreateUser: false</code>）：<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/reference/javascript/auth-signinwithotp?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/reference/javascript/auth-signinwithotp?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="2212" data-end="2307"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">signInWithOtp</span></span><span>({
  email,
  </span><span><span class="hljs-attr">options</span></span><span>: { </span><span><span class="hljs-attr">shouldCreateUser</span></span><span>: </span><span><span class="hljs-literal">true</span></span><span> }
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="2309" data-end="2372">校验验证码并登录（成功会返回 session）：<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="2373" data-end="2458"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">await</span></span><span> supabase.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-title function_">verifyOtp</span></span><span>({
  email,
  </span><span><span class="hljs-attr">token</span></span><span>: code,
  </span><span><span class="hljs-attr">type</span></span><span>: </span><span><span class="hljs-string">'email'</span></span><span>,
})
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<hr data-start="2460" data-end="2463">
<p data-start="2465" data-end="2607">如果你把你现在的 <strong data-start="2474" data-end="2512">Vercel 线上域名（xxx.vercel.app 或自定义域名）</strong>、以及你想要的注册形态（“仅 OTP 无密码”还是“OTP 通过后再设置密码”）告诉我，我可以按你的 Next.js 路由结构给一份完整实现（页面 + 错误处理 + 倒计时 + 反刷参数）。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">我已经进行了Supabase的SMTP配置，但是我没有看到“Supabase → Authentication → Email Templates → Magic Link”</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="204">你没看到 “Authentication → Email Templates → Magic Link”，大概率是 <strong data-start="58" data-end="93">Supabase Dashboard 最近把入口改名/改位置了</strong>：现在通常在 <strong data-start="100" data-end="139">Authentication → Emails → Templates</strong> 里，而不是单独叫 “Email Templates”。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/dashboard/project/.../auth/templates" target="_blank" rel="noopener" alt="https://supabase.com/dashboard/project/.../auth/templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h2 data-start="206" data-end="253">在 Supabase Dashboard 里找到 Magic Link 模板（新版入口）</h2>
<ol data-start="254" data-end="580">
<li data-start="254" data-end="281">
<p data-start="257" data-end="281">进入你的 <strong data-start="262" data-end="273">Project</strong>（不是组织首页）</p>
</li>
<li data-start="282" data-end="307">
<p data-start="285" data-end="307">左侧点 <strong data-start="289" data-end="307">Authentication</strong></p>
</li>
<li data-start="308" data-end="365">
<p data-start="311" data-end="365">在 Authentication 页面里找到 <strong data-start="334" data-end="344">Emails</strong>（有的侧边栏会显示成 “Email”）</p>
</li>
<li data-start="366" data-end="472">
<p data-start="369" data-end="472">在 Emails 下面切到 <strong data-start="383" data-end="396">Templates</strong>（你之前配 SMTP 的地方一般在旁边的 <strong data-start="417" data-end="434">SMTP Settings</strong>）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/dashboard/project/.../auth/templates" target="_blank" rel="noopener" alt="https://supabase.com/dashboard/project/.../auth/templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
</li>
<li data-start="473" data-end="580">
<p data-start="476" data-end="580">你会看到模板列表，其中就包含 <strong data-start="491" data-end="505">Magic link</strong>（以及 Confirm sign up、Reset password 等）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
</li>
</ol>
<p data-start="582" data-end="713">如果你想直接用地址栏跳转（最省事）：<br data-start="600" data-end="603">
<code data-start="603" data-end="675">https://supabase.com/dashboard/project/&lt;你的-project-ref&gt;/auth/templates</code> <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/dashboard/project/.../auth/templates" target="_blank" rel="noopener" alt="https://supabase.com/dashboard/project/.../auth/templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span></p>
<h2 data-start="715" data-end="746">把 Magic Link 改成“6 位 OTP 验证码”</h2>
<p data-start="747" data-end="776">在 <strong data-start="749" data-end="763">Magic link</strong> 模板里，把正文里使用的：</p>
<ul data-start="777" data-end="873">
<li data-start="777" data-end="811">
<p data-start="779" data-end="811"><code data-start="779" data-end="803">{{ .ConfirmationURL }}</code>（链接）<br>
改成：</p>
</li>
<li data-start="812" data-end="873">
<p data-start="814" data-end="873"><code data-start="814" data-end="828">{{ .Token }}</code>（6 位验证码）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
<blockquote data-start="875" data-end="986">
<p data-start="877" data-end="986">Supabase 官方也说明：Magic Link 和 Email OTP 共用同一套实现，“要发 OTP 就改 Magic Link 模板”。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/reference/javascript/auth-signinwithotp" target="_blank" rel="noopener" alt="https://supabase.com/docs/reference/javascript/auth-signinwithotp" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</blockquote>
<hr data-start="988" data-end="991">
<p data-start="993" data-end="1094">如果你愿意，把你 Supabase 项目的 <strong data-start="1015" data-end="1030">project-ref</strong>（URL 里那段短 id）发我，我可以把“直达模板页面”的完整链接按你的项目拼好，并告诉你应该改哪一段模板内容（含中英文示例）。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">resend注册后还需要进行哪些操作</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="64">Resend 注册完以后，一般还要做这几件事才能“稳定可发邮件”（尤其你要用在 Supabase OTP / 登录注册邮件上）：</p>
<h2 data-start="66" data-end="98">1) 先拿到可用的发送凭证（API Key 或 SMTP）</h2>
<ul data-start="99" data-end="408">
<li data-start="99" data-end="194">
<p data-start="101" data-end="194"><strong data-start="101" data-end="115">创建 API Key</strong>（建议权限选 <em data-start="122" data-end="138">sending_access</em>，更安全；也可以限制到某个域名）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/api-reference/api-keys/create-api-key?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/api-reference/api-keys/create-api-key?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="195" data-end="408">
<p data-start="197" data-end="261">如果你打算走 <strong data-start="204" data-end="212">SMTP</strong>（比如给 Supabase 填 Custom SMTP），Resend 的 SMTP 参数是：</p>
<ul data-start="264" data-end="408">
<li data-start="264" data-end="290">
<p data-start="266" data-end="290">Host：<code data-start="271" data-end="288">smtp.resend.com</code></p>
</li>
<li data-start="293" data-end="314">
<p data-start="295" data-end="314">Username：<code data-start="304" data-end="312">resend</code></p>
</li>
<li data-start="317" data-end="408">
<p data-start="319" data-end="408">Password：<strong data-start="328" data-end="349">你的 Resend API Key</strong>（API Key 就是 SMTP 密码）<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/send-with-smtp?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/send-with-smtp?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
</li>
</ul>
<h2 data-start="410" data-end="437">2) 绑定并验证你自己的发信域名（生产环境必做）</h2>
<p data-start="438" data-end="491">在 Resend Dashboard → Domains 里添加你的域名，然后按它给的 DNS 记录去配：</p>
<ul data-start="492" data-end="649">
<li data-start="492" data-end="570">
<p data-start="494" data-end="570"><strong data-start="494" data-end="523">至少要配 SPF + DKIM 两条 DNS 记录</strong> 才算验证通过。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="571" data-end="649">
<p data-start="573" data-end="649">验证通过后，再（可选但强烈建议）加 <strong data-start="591" data-end="600">DMARC</strong> 提升送达与防伪冒。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
<blockquote data-start="650" data-end="728">
<p data-start="652" data-end="728">Resend 也强调：你必须<strong data-start="666" data-end="676">拥有这个域名</strong>（不能用共享/公共域名）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</blockquote>
<h2 data-start="730" data-end="748">3) 设置“From 发件人”</h2>
<p data-start="749" data-end="820">用你已验证域名下的地址当发件人，比如：<code data-start="768" data-end="793">no-reply@yourdomain.com</code>（并在 Resend/Supabase 里保持一致）。</p>
<h2 data-start="822" data-end="852">4) 先用 Resend 的测试地址把链路跑通（推荐）</h2>
<p data-start="853" data-end="950">Resend 提供专门的测试收件地址（支持 <code data-start="875" data-end="883">+label</code> 做区分），可以用来验证“投递成功/退信/投诉”等场景：<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/docs/dashboard/emails/send-test-emails?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/emails/send-test-emails?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<ul data-start="951" data-end="1084">
<li data-start="951" data-end="982">
<p data-start="953" data-end="982">成功投递：<code data-start="958" data-end="980">delivered@resend.dev</code></p>
</li>
<li data-start="983" data-end="1010">
<p data-start="985" data-end="1010">退信：<code data-start="988" data-end="1008">bounced@resend.dev</code></p>
</li>
<li data-start="1011" data-end="1084">
<p data-start="1013" data-end="1084">标记垃圾/投诉：<code data-start="1021" data-end="1044">complained@resend.dev</code> <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.dev/?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.dev/?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
<h2 data-start="1086" data-end="1133">5) 上线前最好把 Webhook 和 Suppression 处理想好（可选但很有用）</h2>
<ul data-start="1134" data-end="1371">
<li data-start="1134" data-end="1247">
<p data-start="1136" data-end="1247"><strong data-start="1136" data-end="1147">Webhook</strong>：Resend 能把发送事件（投递、退信等）推到你的 HTTPS endpoint，方便你自动清理无效邮箱、做告警/统计。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/webhooks/introduction?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/webhooks/introduction?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
<li data-start="1248" data-end="1371">
<p data-start="1250" data-end="1371"><strong data-start="1250" data-end="1270">Suppression List</strong>：如果某地址出现硬退信，会被加入 suppression list，Resend 会阻止你继续发到这个地址，以保护域名信誉。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/knowledge-base/why-are-my-emails-landing-on-the-suppression-list?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/knowledge-base/why-are-my-emails-landing-on-the-suppression-list?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
<h2 data-start="1373" data-end="1401">6) 了解免费额度，避免“验证码邮件突然发不出去”</h2>
<p data-start="1402" data-end="1517">Resend Free 账号额度是 <strong data-start="1420" data-end="1440">100 封/天、3000 封/月</strong>，并且 <strong data-start="1444" data-end="1468">To/CC/BCC 每个收件人都单独计数</strong>（收信也计入额度）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/knowledge-base/resend-email-quota?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/knowledge-base/resend-email-quota?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
<hr data-start="1519" data-end="1522">
<h3 data-start="1524" data-end="1557">如果你是为了 Supabase OTP（你前面提到的场景）</h3>
<p data-start="1558" data-end="1661">你做完上面 <strong data-start="1564" data-end="1577">1 + 2 + 3</strong> 后，就可以在 Supabase 里把 Custom SMTP 指向 Resend（SMTP 密码用 API Key），然后让 Supabase 负责发 OTP 邮件。</p>
<p data-start="1663" data-end="1750">如果你告诉我你现在用的是 <strong data-start="1676" data-end="1685">自定义域名</strong> 还是只有 <code data-start="1691" data-end="1707">xxx.vercel.app</code>，我可以按你的情况给一个“最少步骤版本”的清单（开发/预览环境怎么处理、生产怎么配）。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">我用的是spaceship，这里怎么添加DNS</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="104">在 Spaceship 里加 Resend 的 DNS 记录，大致就两步：<strong data-start="37" data-end="64">确认 DNS 真的是在 Spaceship 管</strong> → <strong data-start="67" data-end="103">去 Advanced DNS 里添加 TXT（SPF/DKIM）</strong>。</p>
<h2 data-start="106" data-end="146">0) 先确认：你现在是不是用的 Spaceship Nameservers</h2>
<p data-start="147" data-end="313">如果你把域名改成了 <strong data-start="157" data-end="194">Custom nameservers（比如 Cloudflare）</strong>，那就<strong data-start="197" data-end="218">不能在 Spaceship 加记录</strong>；你在 Spaceship 里改到的会是 <em data-start="239" data-end="249">Inactive</em>，不会生效，需要去你那个第三方 DNS 服务商里加。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 76px;"><a href="https://www.spaceship.com/knowledgebase/connect-domain-custom-nameservers/?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://www.spaceship.com/knowledgebase/connect-domain-custom-nameservers/?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 76px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Spaceship.com</span></span></span></a></span></span></p>
<h2 data-start="315" data-end="343">1) 在 Resend 拿到要添加的 DNS 记录</h2>
<p data-start="344" data-end="528">Resend 验证域名时会让你添加 <strong data-start="362" data-end="386">两条 DNS 记录：SPF + DKIM</strong>（验证通过后可选再加 DMARC）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span><br data-start="442" data-end="445">
在 Resend Dashboard → <strong data-start="466" data-end="477">Domains</strong> → 选你的域名 → 页面里会给你每条记录的 <strong data-start="500" data-end="523">Type / Name / Value</strong>（照抄）。</p>
<blockquote data-start="530" data-end="609">
<p data-start="532" data-end="609">Resend 文档也说明 SPF/DKIM 本质上都是 <strong data-start="560" data-end="570">TXT 记录</strong>。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</blockquote>
<h2 data-start="611" data-end="652">2) 在 Spaceship 添加 DNS（TXT/CNAME 都在这里加）</h2>
<p data-start="653" data-end="672">常见入口路径（界面字样可能略有不同）：</p>
<ul data-start="673" data-end="833">
<li data-start="673" data-end="833">
<p data-start="675" data-end="833">登录 Spaceship → <strong data-start="690" data-end="708">Domain Manager</strong> → 选中你的域名 → <strong data-start="720" data-end="741">Nameservers &amp; DNS</strong> → <strong data-start="744" data-end="760">Advanced DNS</strong> → 在 DNS records 面板点 <strong data-start="781" data-end="795">Add record</strong> <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 80px;"><a href="https://mymangomail.com/docs/articles/spaceship-dns-setup?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://mymangomail.com/docs/articles/spaceship-dns-setup?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 80px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Mango Mail</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
<p data-start="835" data-end="856">然后按 Resend 给的内容，逐条添加：</p>
<h3 data-start="858" data-end="877">A) SPF（TXT，根域名）</h3>
<ul data-start="878" data-end="1031">
<li data-start="878" data-end="894">
<p data-start="880" data-end="894"><strong data-start="880" data-end="888">Type</strong>：TXT</p>
</li>
<li data-start="895" data-end="927">
<p data-start="897" data-end="927"><strong data-start="897" data-end="910">Host/Name</strong>：通常填 <code data-start="915" data-end="918">@</code>（代表根域名）</p>
</li>
<li data-start="928" data-end="1031">
<p data-start="930" data-end="1031"><strong data-start="930" data-end="947">Value/Content</strong>：把 Resend 给你的 SPF 值完整粘贴进去（一般是 <code data-start="977" data-end="989">v=spf1 ...</code> 开头） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
<p data-start="1033" data-end="1153">⚠️ 根域名上 <strong data-start="1041" data-end="1054">SPF 只能有一条</strong>；如果你之前已经有 SPF，要把多个 include 合并到同一条 SPF 里（SPF 允许多个 <code data-start="1103" data-end="1113">include:</code>）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 76px;"><a href="https://www.spaceship.com/knowledgebase/spacemail-dns-setup-namecheap/?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://www.spaceship.com/knowledgebase/spacemail-dns-setup-namecheap/?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 76px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Spaceship.com</span></span></span></a></span></span></p>
<h3 data-start="1155" data-end="1191">B) DKIM（TXT，形如 <code data-start="1174" data-end="1190">xxx._domainkey</code>）</h3>
<ul data-start="1192" data-end="1367">
<li data-start="1192" data-end="1208">
<p data-start="1194" data-end="1208"><strong data-start="1194" data-end="1202">Type</strong>：TXT</p>
</li>
<li data-start="1209" data-end="1285">
<p data-start="1211" data-end="1285"><strong data-start="1211" data-end="1224">Host/Name</strong>：把 Resend 给你的 DKIM “Name” 原样填（通常长得像 <code data-start="1260" data-end="1282">something._domainkey</code>）</p>
</li>
<li data-start="1286" data-end="1367">
<p data-start="1288" data-end="1367"><strong data-start="1288" data-end="1305">Value/Content</strong>：粘贴 Resend 给的公钥内容（很长的一串） <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span></p>
</li>
</ul>
<h3 data-start="1369" data-end="1396">C) 可选：DMARC（TXT，推荐上线后加）</h3>
<p data-start="1397" data-end="1517">Resend 说 SPF/DKIM 过了以后可以加 DMARC 来提升信任度。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 46px;"><a href="https://resend.com/docs/dashboard/domains/introduction" target="_blank" rel="noopener" alt="https://resend.com/docs/dashboard/domains/introduction" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 46px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span></span></span></a></span></span><br data-start="1474" data-end="1477">
（如果你要我给一条“保守不拦截”的 DMARC 值，我也可以直接给你一份模板。）</p>
<h2 data-start="1519" data-end="1547">3) 等待生效并在 Resend 点 Verify</h2>
<p data-start="1548" data-end="1681">DNS 不是立刻生效，Spaceship 的指引里也提到可能要一段传播时间（有时可到 48 小时）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 76px;"><a href="https://www.spaceship.com/knowledgebase/connect-domain-to-spaceship-hosting/?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://www.spaceship.com/knowledgebase/connect-domain-to-spaceship-hosting/?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 76px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Spaceship.com</span></span></span></a></span></span><br data-start="1636" data-end="1639">
回到 Resend 域名页面点 <strong data-start="1655" data-end="1677">Verify DNS Records</strong> 即可。</p>
<hr data-start="1683" data-end="1686">
<p data-start="1688" data-end="1812">如果你把 <strong data-start="1693" data-end="1734">Resend 域名验证页面给你的两条记录（Type/Name/Value）</strong> 复制出来（打码也行），我可以按 Spaceship 的字段给你逐行对照：哪条填 <code data-start="1775" data-end="1778">@</code>、哪条填 <code data-start="1783" data-end="1795">_domainkey</code>，以及你现有 SPF 该怎么合并。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content"><img src="https://raw.githubusercontent.com/jewel-robot/chatgpt-images/main/images/note_1766322601622_img_0_1766322601650.png" alt="已上传的图片" style="max-width: 100%; height: auto; display: block; margin: 8px 0px; border-radius: 8px;" data-github-path="images/note_1766322601622_img_0_1766322601650.png" data-github-sha="aa571368a7ae46494b9d3d5c45ed123184b5581e">界面是这样，要怎么填</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="74">你这个界面就是标准的 DNS 记录新增表单（左边“主机/Host”，中间“类型/Type”，右边“值/Value”，再选 TTL，最后点“添加”）。</p>
<p data-start="76" data-end="123">下面按 Resend 最常见的 <strong data-start="92" data-end="114">SPF + DKIM（两条 TXT）</strong> 来告诉你怎么填：</p>
<hr data-start="125" data-end="128">
<h2 data-start="130" data-end="150">1）添加 SPF（TXT，根域名）</h2>
<p data-start="151" data-end="206">在 Resend 的 Domains 页面里会给你一条 SPF（Value 通常以 <code data-start="193" data-end="201">v=spf1</code> 开头）。</p>
<p data-start="208" data-end="216">在你这个界面填：</p>
<ul data-start="218" data-end="406">
<li data-start="218" data-end="283">
<p data-start="220" data-end="283"><strong data-start="220" data-end="232">主机（Host）</strong>：填 <code data-start="235" data-end="238">@</code><br data-start="238" data-end="241">
（你截图里左边就是 <code data-start="253" data-end="256">@</code>，右边自动拼上 <code data-start="264" data-end="277">.875538.xyz</code>，这就对了）</p>
</li>
<li data-start="284" data-end="300">
<p data-start="286" data-end="300"><strong data-start="286" data-end="292">类型</strong>：选 <code data-start="295" data-end="300">TXT</code></p>
</li>
<li data-start="301" data-end="370">
<p data-start="303" data-end="370"><strong data-start="303" data-end="308">值</strong>：把 Resend 给你的 SPF 那串完整粘贴进去<br data-start="334" data-end="337">
例子长这样：<code data-start="345" data-end="370">v=spf1 include:... ~all</code></p>
</li>
<li data-start="371" data-end="391">
<p data-start="373" data-end="391"><strong data-start="373" data-end="380">TTL</strong>：30 分钟/默认都行</p>
</li>
<li data-start="392" data-end="406">
<p data-start="394" data-end="406">点右侧 <strong data-start="398" data-end="406">“添加”</strong></p>
</li>
</ul>
<p data-start="408" data-end="511">⚠️ 如果你域名里<strong data-start="417" data-end="428">已经有 SPF</strong>（也是 <code data-start="432" data-end="444">v=spf1 ...</code>），不要新加第二条 SPF，而是把 Resend 的 <code data-start="471" data-end="484">include:...</code> 合并进已有那一条（SPF 同一域名只建议保留一条）。</p>
<hr data-start="513" data-end="516">
<h2 data-start="518" data-end="555">2）添加 DKIM（TXT，形如 <code data-start="538" data-end="554">xxx._domainkey</code>）</h2>
<p data-start="556" data-end="627">Resend 会给一条 DKIM，Name 通常像：<code data-start="582" data-end="601">resend._domainkey</code> 或一串前缀 <code data-start="608" data-end="623">s1._domainkey</code> 之类。</p>
<p data-start="629" data-end="638">在你这个界面操作：</p>
<p data-start="640" data-end="668">先点左下 <strong data-start="645" data-end="657">“+ 添加记录”</strong>（新增一行），然后填：</p>
<ul data-start="670" data-end="988">
<li data-start="670" data-end="872">
<p data-start="672" data-end="716"><strong data-start="672" data-end="684">主机（Host）</strong>：填 Resend 给的 <strong data-start="697" data-end="705">Name</strong> 里“域名前面那部分”</p>
<ul data-start="719" data-end="872">
<li data-start="719" data-end="798">
<p data-start="721" data-end="798">如果 Resend 给的是：<code data-start="735" data-end="765">resend._domainkey.875538.xyz</code><br data-start="765" data-end="768">
✅ 你这里填：<code data-start="779" data-end="798">resend._domainkey</code></p>
</li>
<li data-start="801" data-end="872">
<p data-start="803" data-end="872">如果 Resend 给的是：<code data-start="817" data-end="836">resend._domainkey</code><br data-start="836" data-end="839">
✅ 你这里也直接填：<code data-start="853" data-end="872">resend._domainkey</code></p>
</li>
</ul>
</li>
<li data-start="873" data-end="889">
<p data-start="875" data-end="889"><strong data-start="875" data-end="881">类型</strong>：选 <code data-start="884" data-end="889">TXT</code></p>
</li>
<li data-start="890" data-end="958">
<p data-start="892" data-end="958"><strong data-start="892" data-end="897">值</strong>：把 Resend 给的 DKIM value 粘贴进去（通常很长，像 <code data-start="933" data-end="957">v=DKIM1; k=rsa; p=....</code>）</p>
</li>
<li data-start="959" data-end="973">
<p data-start="961" data-end="973"><strong data-start="961" data-end="968">TTL</strong>：默认即可</p>
</li>
<li data-start="974" data-end="988">
<p data-start="976" data-end="988">点右侧 <strong data-start="980" data-end="988">“添加”</strong></p>
</li>
</ul>
<hr data-start="990" data-end="993">
<h2 data-start="995" data-end="1017">3）常见填错点（你这个界面尤其要注意）</h2>
<ul data-start="1018" data-end="1162">
<li data-start="1018" data-end="1130">
<p data-start="1020" data-end="1130"><strong data-start="1020" data-end="1026">不要</strong>在“主机”里填完整域名（因为你右侧已经自动拼了 <code data-start="1050" data-end="1063">.875538.xyz</code>）<br data-start="1064" data-end="1067">
也就是说：只填 <code data-start="1077" data-end="1096">resend._domainkey</code>，别填 <code data-start="1100" data-end="1130">resend._domainkey.875538.xyz</code></p>
</li>
<li data-start="1131" data-end="1162">
<p data-start="1133" data-end="1162"><strong data-start="1133" data-end="1139">不要</strong>手动加引号 <code data-start="1145" data-end="1152">"..."</code>（一般直接粘贴即可）</p>
</li>
</ul>
<hr data-start="1164" data-end="1167">
<p data-start="1169" data-end="1301">如果你把 Resend 域名验证页面里两条记录的 <strong data-start="1194" data-end="1210">Name / Value</strong> 贴出来（可以把域名打码、但保留 <code data-start="1227" data-end="1239">_domainkey</code> 和 <code data-start="1242" data-end="1249">v=...</code> 这些结构），我可以帮你逐条对照：哪条主机填 <code data-start="1272" data-end="1275">@</code>、哪条填什么前缀，以及是否需要合并你现有的 SPF。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content"><img src="https://raw.githubusercontent.com/jewel-robot/chatgpt-images/main/images/note_1766322601622_img_0_1766322603909.png" alt="已上传的图片" style="max-width: 100%; height: auto; display: block; margin: 8px 0px; border-radius: 8px;" data-github-path="images/note_1766322601622_img_0_1766322603909.png" data-github-sha="8886dbe6af6f0b16fb66e11011dbe1aa6317c28d">我这样填写对吗</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="121">看你这张图，<strong data-start="6" data-end="23">记录的类型和方向基本是对的</strong>（MX + DKIM(TXT) + SPF(TXT) + DMARC(TXT)），但“对不对”取决于你 <strong data-start="75" data-end="92">最终打算用哪个域名当发件人</strong>。我帮你逐条核对一下你现在这组的含义，以及最容易出错的点。</p>
<h2 data-start="123" data-end="137">你现在这组记录表示什么</h2>
<ol data-start="138" data-end="654">
<li data-start="138" data-end="315">
<p data-start="141" data-end="315"><strong data-start="141" data-end="210">MX：<code data-start="146" data-end="159">send.update</code> → <code data-start="162" data-end="201">feedback-smtp.us-east-1.amazonses.com</code>（优先级 0）</strong><br data-start="210" data-end="213">
这一般是用于设置 <strong data-start="222" data-end="253">MAIL FROM / Return-Path 子域名</strong>（退信、反馈路由）。只有当 Resend 验证页面明确让你加这个 MX（并且主机名是 <code data-start="296" data-end="309">send.update</code>）时才需要。</p>
</li>
<li data-start="317" data-end="472">
<p data-start="320" data-end="472"><strong data-start="320" data-end="386">DKIM：<code data-start="327" data-end="346">resend._domainkey</code>（你图里显示成 <code data-start="354" data-end="370">resend._dor...</code>）→ TXT <code data-start="377" data-end="384">p=...</code></strong><br data-start="386" data-end="389">
这是 DKIM 公钥记录，看起来方向没问题。<strong data-start="411" data-end="448">关键是主机名必须一字不差是 <code data-start="427" data-end="446">resend._domainkey</code></strong>（有些 UI 会截断显示，但保存后要确认完整）。</p>
</li>
<li data-start="474" data-end="590">
<p data-start="477" data-end="590"><strong data-start="477" data-end="540">SPF：<code data-start="483" data-end="496">send.update</code> → TXT <code data-start="503" data-end="538">v=spf1 include:amazonses.com ~all</code></strong><br data-start="540" data-end="543">
这条 SPF 是给 <strong data-start="553" data-end="587"><code data-start="555" data-end="579">send.update.875538.xyz</code> 这个子域名</strong>用的。</p>
</li>
<li data-start="592" data-end="654">
<p data-start="595" data-end="654"><strong data-start="595" data-end="639">DMARC：<code data-start="603" data-end="611">_dmarc</code> → TXT <code data-start="618" data-end="637">v=DMARC1; p=none;</code></strong><br data-start="639" data-end="642">
这条 OK（监控模式）。</p>
</li>
</ol>
<hr data-start="656" data-end="659">
<h2 data-start="661" data-end="687">最关键的检查点：你的“发件人邮箱”用哪个域名？</h2>
<p data-start="688" data-end="733">你现在 SPF 放在 <strong data-start="699" data-end="727"><code data-start="701" data-end="725">send.update.875538.xyz</code></strong> 上，所以：</p>
<ul data-start="735" data-end="1063">
<li data-start="735" data-end="841">
<p data-start="737" data-end="841">✅ 如果你打算在 Supabase/Resend 里用发件人：<br data-start="768" data-end="771">
<strong data-start="773" data-end="810"><code data-start="775" data-end="808">no-reply@send.update.875538.xyz</code></strong><br data-start="810" data-end="813">
那这组配置更可能是正确的（SPF 与发件人域一致）。</p>
</li>
<li data-start="843" data-end="1063">
<p data-start="845" data-end="1063">❌ 如果你打算用发件人：<br data-start="857" data-end="860">
<strong data-start="862" data-end="887"><code data-start="864" data-end="885">no-reply@875538.xyz</code></strong>（根域名）<br data-start="892" data-end="895">
那你现在的 SPF 在 <code data-start="909" data-end="922">send.update</code> 子域名上，<strong data-start="928" data-end="957">根域名 <code data-start="934" data-end="946">875538.xyz</code> 没有对应 SPF</strong>，就可能导致 SPF 对不上（投递/进垃圾箱风险上升）。<br data-start="985" data-end="988">
这种情况下，你应该把 SPF（以及 Resend 要求的其他验证记录）按 Resend 要求加在根域名（通常主机是 <code data-start="1048" data-end="1051">@</code>）或改用子域名做发件人。</p>
</li>
</ul>
<hr data-start="1065" data-end="1068">
<h2 data-start="1070" data-end="1092">我建议你现在做的 2 个动作（不用猜）</h2>
<ol data-start="1093" data-end="1380">
<li data-start="1093" data-end="1248">
<p data-start="1096" data-end="1148">回到 Resend 的 Domain 验证页面，逐条对照 <strong data-start="1125" data-end="1145">Name/Host 是否完全一致</strong>：</p>
<ul data-start="1152" data-end="1248">
<li data-start="1152" data-end="1192">
<p data-start="1154" data-end="1192"><code data-start="1154" data-end="1167">send.update</code> 的 MX 是否就是 Resend 给你的要求</p>
</li>
<li data-start="1196" data-end="1248">
<p data-start="1198" data-end="1248">DKIM 的 Host 是否完整是 <code data-start="1216" data-end="1235">resend._domainkey</code>（不是少字/多了域名后缀）</p>
</li>
</ul>
</li>
<li data-start="1250" data-end="1380">
<p data-start="1253" data-end="1297">确认你在 Supabase 里准备填的 <strong data-start="1273" data-end="1289">Sender email</strong> 是哪一个：</p>
<ul data-start="1301" data-end="1380">
<li data-start="1301" data-end="1345">
<p data-start="1303" data-end="1345">用子域名就填 <code data-start="1310" data-end="1343">no-reply@send.update.875538.xyz</code></p>
</li>
<li data-start="1349" data-end="1380">
<p data-start="1351" data-end="1380">用根域名就要在根域名上也按 Resend 要求补齐对应记录</p>
</li>
</ul>
</li>
</ol>
<hr data-start="1382" data-end="1385">
<p data-start="1387" data-end="1547">如果你把 Resend 域名验证页上显示的两条/四条记录（<strong data-start="1416" data-end="1439">Name / Type / Value</strong>）原样贴出来（Value 太长可以只保留开头几十个字符），我可以直接告诉你：你这四条是否“完全匹配”，以及你应该用 <code data-start="1497" data-end="1510">@875538.xyz</code> 还是 <code data-start="1514" data-end="1539">@send.update.875538.xyz</code> 当发件人最稳。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">所以整个步骤下来这个code其实是supbase生成的，但是通过resend发送是吗</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="99">对，你理解得基本正确：<strong data-start="11" data-end="55">验证码（OTP code / token）是 Supabase Auth 生成的</strong>，而你把 <strong data-start="60" data-end="98">SMTP 配成 Resend 之后，邮件是通过 Resend 发出去</strong>。</p>
<p data-start="101" data-end="107">更精确地说：</p>
<ul data-start="109" data-end="283">
<li data-start="109" data-end="202">
<p data-start="111" data-end="202"><strong data-start="111" data-end="138">生成验证码 + 校验验证码 + 创建/登录用户</strong>：都由 <strong data-start="142" data-end="159">Supabase Auth</strong> 完成（你前端调用 <code data-start="169" data-end="184">signInWithOtp</code> / <code data-start="187" data-end="198">verifyOtp</code>）。</p>
</li>
<li data-start="203" data-end="283">
<p data-start="205" data-end="283"><strong data-start="205" data-end="216">发送邮件这一步</strong>：Supabase 会把“要发的内容”交给你配置的 <strong data-start="242" data-end="250">SMTP</strong>，也就是 <strong data-start="255" data-end="278">Resend 的 SMTP relay</strong> 来投递。</p>
</li>
</ul>
<p data-start="285" data-end="324">所以你不需要自己在 Vercel 里生成 6 位码、建临时表、再发邮件；只要：</p>
<ol data-start="325" data-end="486">
<li data-start="325" data-end="361">
<p data-start="328" data-end="361">Supabase 配好 Custom SMTP（Resend）</p>
</li>
<li data-start="362" data-end="426">
<p data-start="365" data-end="426">把邮件模板从 <code data-start="372" data-end="396">{{ .ConfirmationURL }}</code> 改成 <code data-start="400" data-end="414">{{ .Token }}</code>（让邮件显示验证码）</p>
</li>
<li data-start="427" data-end="486">
<p data-start="430" data-end="486">前端：<code data-start="433" data-end="455">signInWithOtp(email)</code> 发码，<code data-start="459" data-end="483">verifyOtp(email, code)</code> 验证</p>
</li>
</ol>
<p data-start="488" data-end="541">这样整个 OTP 流程就是：<strong data-start="502" data-end="541">Supabase 负责“验证码逻辑”，Resend 负责“邮件通道”。</strong></p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">但是我收到的却是8位的：Your verification code is: 89692480
这是我的配置：
&lt;p&gt;Your verification code is: &lt;b&gt;{{ .Token }}&lt;/b&gt;&lt;/p&gt;  

</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="193">你这段模板写法没问题（<code data-start="11" data-end="25">{{ .Token }}</code>）。之所以你收到 <strong data-start="34" data-end="41">8 位</strong>（<code data-start="42" data-end="52">89692480</code>），通常是因为 <strong data-start="60" data-end="92">Supabase 的 Email OTP 长度是可配置的</strong>：默认文档里把 <code data-start="100" data-end="114">{{ .Token }}</code>描述为“6 位 OTP”，但项目里可以把 OTP 长度调大（比如 8 位）来提高熵。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 70px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 70px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h3 data-start="195" data-end="203">先说结论</h3>
<ul data-start="204" data-end="332">
<li data-start="204" data-end="259">
<p data-start="206" data-end="259"><strong data-start="206" data-end="222">8 位验证码是正常可用的</strong>，<code data-start="223" data-end="234">verifyOtp</code> 照样能验证（你前端输入框不要强制 6 位就行）。</p>
</li>
<li data-start="260" data-end="332">
<p data-start="262" data-end="332">如果你<strong data-start="265" data-end="276">想改回 6 位</strong>：去 Supabase Dashboard 里改 Email provider 的 OTP length 设置。</p>
</li>
</ul>
<h3 data-start="334" data-end="370">在 Supabase 里改回 6 位（Dashboard 路径）</h3>
<p data-start="371" data-end="488">Supabase 维护者在 GitHub 讨论里明确说：<strong data-start="399" data-end="450">OTP 位数在 Dashboard 的 Email provider settings 里能改</strong>。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 45px;"><a href="https://github.com/orgs/supabase/discussions/40187" target="_blank" rel="noopener" alt="https://github.com/orgs/supabase/discussions/40187" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 45px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">GitHub</span></span></span></a></span></span></p>
<p data-start="490" data-end="514">你可以按这个思路找（不同版本界面名字略有差异）：</p>
<ol data-start="515" data-end="681">
<li data-start="515" data-end="557">
<p data-start="518" data-end="557">Supabase Dashboard → <strong data-start="539" data-end="557">Authentication</strong></p>
</li>
<li data-start="558" data-end="604">
<p data-start="561" data-end="604">找 <strong data-start="563" data-end="594">Providers / Sign In / Email</strong>（邮件登录的设置页）</p>
</li>
<li data-start="605" data-end="666">
<p data-start="608" data-end="627">在 Email 相关设置里找类似字段：</p>
<ul data-start="631" data-end="666">
<li data-start="631" data-end="666">
<p data-start="633" data-end="666"><strong data-start="633" data-end="666">Email OTP length / OTP length</strong></p>
</li>
</ul>
</li>
<li data-start="667" data-end="681">
<p data-start="670" data-end="681">改成 <strong data-start="673" data-end="678">6</strong> 保存</p>
</li>
</ol>
<h3 data-start="683" data-end="707">为什么文档说 6 位、你却收到 8 位？</h3>
<p data-start="708" data-end="883">Supabase 文档对 <code data-start="721" data-end="735">{{ .Token }}</code> 的说明是 “包含 6 位 OTP”。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 55px;"><a href="https://supabase.com/docs/guides/auth/auth-email-templates?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://supabase.com/docs/guides/auth/auth-email-templates?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 55px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Supabase</span></span></span></a></span></span><br data-start="791" data-end="794">
但实际实现允许项目把 OTP 长度调到更长（你现在显然就是被设成 8 了），所以邮件里就会显示 8 位。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 45px;"><a href="https://github.com/orgs/supabase/discussions/40187" target="_blank" rel="noopener" alt="https://github.com/orgs/supabase/discussions/40187" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 45px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between overflow-hidden" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">GitHub</span></span></span></a></span></span></p>
<hr data-start="885" data-end="888">
<p data-start="890" data-end="1006">如果你愿意，把你 Supabase 控制台里 <strong data-start="913" data-end="949">Authentication → Providers/Email</strong> 那一页的截图发我（把 project-ref 打码也行），我可以帮你指出“OTP length”具体在哪个位置。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">我要怎么在supbase中删除用户数据呢</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="124">在 Supabase 里“删除用户”分两块：<strong data-start="22" data-end="47">Auth 用户（<code data-start="32" data-end="44">auth.users</code>）</strong> 和 <strong data-start="50" data-end="93">你自己建的业务表（<code data-start="61" data-end="78">public.profiles</code> / <code data-start="81" data-end="88">users</code> 等）</strong>。很多人只删了业务表，结果 Auth 里用户还在，或者反过来。</p>
<p data-start="126" data-end="153">下面给你最常用、最安全的几种方式（按你要做的事情选）。</p>
<hr data-start="155" data-end="158">
<h2 data-start="160" data-end="189">方式 1：在 Dashboard 手动删除（最简单）</h2>
<ol data-start="190" data-end="298">
<li data-start="190" data-end="243">
<p data-start="193" data-end="243">打开 Supabase Dashboard → <strong data-start="217" data-end="243">Authentication → Users</strong></p>
</li>
<li data-start="244" data-end="261">
<p data-start="247" data-end="261">找到要删的用户（按邮箱搜索）</p>
</li>
<li data-start="262" data-end="298">
<p data-start="265" data-end="298">点进去 → 选择 <strong data-start="274" data-end="289">Delete user</strong>（或右侧菜单删除）</p>
</li>
</ol>
<p data-start="300" data-end="387">这会删除 <strong data-start="305" data-end="318">Auth 里的用户</strong>（也就是登录账号本体）。<br data-start="330" data-end="333">
但你自己建的业务表（比如 <code data-start="346" data-end="363">public.profiles</code>）是否自动删，要看你有没有做外键级联（见下面）。</p>
<hr data-start="389" data-end="392">
<h2 data-start="394" data-end="419">方式 2：SQL 删除（适合批量/精确控制）</h2>
<h3 data-start="420" data-end="449">2.1 只删业务表里的某个用户资料（不删登录账号）</h3>
<p data-start="450" data-end="491">例如你的资料表 <code data-start="458" data-end="475">public.profiles</code> 用 <code data-start="478" data-end="487">user_id</code> 关联：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="492" data-end="586"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">sql</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-sql"><span><span><span class="hljs-keyword">delete</span></span><span> </span><span><span class="hljs-keyword">from</span></span><span> public.profiles
</span><span><span class="hljs-keyword">where</span></span><span> user_id </span><span><span class="hljs-operator">=</span></span><span> </span><span><span class="hljs-string">'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'</span></span><span>;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<h3 data-start="588" data-end="631">2.2 删 Auth 用户（通常需要 Service Role / 管理权限）</h3>
<p data-start="632" data-end="766"><strong data-start="632" data-end="663">直接 <code data-start="637" data-end="661">delete from auth.users</code></strong> 在很多项目里会被权限/RLS挡住；更推荐用 <strong data-start="686" data-end="699">Admin API</strong>（下一种方式）。<br data-start="707" data-end="710">
如果你是用 Dashboard 的 SQL Editor 以管理员身份执行，有时也能删，但不建议把这当常规做法。</p>
<hr data-start="768" data-end="771">
<h2 data-start="773" data-end="811">方式 3：用 Admin API 删除（推荐用于代码里做“注销账号”）</h2>
<p data-start="812" data-end="874">如果你想在后端（Vercel API / Edge Function）里删除用户，用 Supabase Admin API：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="876" data-end="1106"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">js</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-js"><span><span><span class="hljs-keyword">import</span></span><span> { createClient } </span><span><span class="hljs-keyword">from</span></span><span> </span><span><span class="hljs-string">'@supabase/supabase-js'</span></span><span>

</span><span><span class="hljs-keyword">const</span></span><span> supabaseAdmin = </span><span><span class="hljs-title function_">createClient</span></span><span>(
  process.</span><span><span class="hljs-property">env</span></span><span>.</span><span><span class="hljs-property">SUPABASE_URL</span></span><span>,
  process.</span><span><span class="hljs-property">env</span></span><span>.</span><span><span class="hljs-property">SUPABASE_SERVICE_ROLE_KEY</span></span><span> </span><span><span class="hljs-comment">// 千万别放前端</span></span><span>
)

</span><span><span class="hljs-keyword">await</span></span><span> supabaseAdmin.</span><span><span class="hljs-property">auth</span></span><span>.</span><span><span class="hljs-property">admin</span></span><span>.</span><span><span class="hljs-title function_">deleteUser</span></span><span>(userId)
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<ul data-start="1108" data-end="1184">
<li data-start="1108" data-end="1122">
<p data-start="1110" data-end="1122">✅ 能删 Auth 用户</p>
</li>
<li data-start="1123" data-end="1141">
<p data-start="1125" data-end="1141">✅ 适合你做“用户自助注销账号”</p>
</li>
<li data-start="1142" data-end="1184">
<p data-start="1144" data-end="1184">⚠️ <code data-start="1147" data-end="1165">SERVICE_ROLE_KEY</code> 必须只在服务端，泄漏就等于全库管理员</p>
</li>
</ul>
<hr data-start="1186" data-end="1189">
<h2 data-start="1191" data-end="1223">方式 4：让业务数据跟着 Auth 用户一起删（推荐做法）</h2>
<p data-start="1224" data-end="1332">如果你有 <code data-start="1229" data-end="1255">public.profiles(user_id)</code> 外键指向 <code data-start="1261" data-end="1277">auth.users(id)</code>，把外键设成 <strong data-start="1284" data-end="1305">ON DELETE CASCADE</strong>，这样你删除 Auth 用户时，资料表会自动级联删除：</p>
<div class="clipper-code-wrap"><pre class="overflow-visible! px-0!" data-start="1334" data-end="1476"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">sql</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"><button class="flex gap-1 items-center select-none py-1" aria-label="复制"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon-sm"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg>复制代码</button></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-sql"><span><span><span class="hljs-keyword">alter table</span></span><span> public.profiles
</span><span><span class="hljs-keyword">add constraint</span></span><span> profiles_user_id_fkey
</span><span><span class="hljs-keyword">foreign key</span></span><span> (user_id) </span><span><span class="hljs-keyword">references</span></span><span> auth.users(id)
</span><span><span class="hljs-keyword">on</span></span><span> </span><span><span class="hljs-keyword">delete</span></span><span> cascade;
</span></span></code></div></div></pre><button class="clipper-copy-btn" type="button">复制</button></div>
<p data-start="1478" data-end="1511">这样你以后只需要删 Auth 用户，业务表就不会留下“孤儿数据”。</p>
<hr data-start="1513" data-end="1516">
<h2 data-start="1518" data-end="1542">我需要你告诉我一件事，才能给你最精准的操作</h2>
<p data-start="1543" data-end="1557">你说的“删除用户数据”是指：</p>
<ol data-start="1558" data-end="1627">
<li data-start="1558" data-end="1585">
<p data-start="1561" data-end="1585">只删除 <strong data-start="1565" data-end="1576">Auth 账号</strong>（不能再登录）</p>
</li>
<li data-start="1586" data-end="1610">
<p data-start="1589" data-end="1610">只删除 <strong data-start="1593" data-end="1602">业务表数据</strong>（账号还在）</p>
</li>
<li data-start="1611" data-end="1627">
<p data-start="1614" data-end="1627">两者都删（并且想自动级联）</p>
</li>
</ol>
<p data-start="1629" data-end="1704">以及你现在有没有类似 <code data-start="1640" data-end="1650">profiles</code> / <code data-start="1653" data-end="1660">users</code> 这样的表？如果你把表名/字段（或截图）给我，我可以给你一条完全对应你库结构的 SQL。</p>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">通过这种resend邮箱转发的形式，发送给对方的邮箱好像会显示由xxxxx@send.updates.875538.xyz代发，怎么改成固定的呢比如jewel@send.updates.875538.xyz</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="106">可以改成固定的。你现在看到的“由 <code data-start="17" data-end="48">xxxxx@send.updates.875538.xyz</code> 代发”，本质上是 <strong data-start="58" data-end="97">Supabase（或你的系统）在 SMTP 发信时用的 From 地址</strong>不是你想要的那个。</p>
<p data-start="108" data-end="208">要让收件人固定看到比如 <code data-start="120" data-end="150">jewel@send.update.875538.xyz</code>，你需要把 **From（发件人）**设置成这个地址，并确保它在 Resend/Supabase 的域名验证范围内。</p>
<h2 data-start="210" data-end="218">你该怎么改</h2>
<h3 data-start="220" data-end="260">1) 在 Supabase 里改 Sender email（发件人地址）</h3>
<p data-start="261" data-end="332">Supabase Dashboard → **Authentication → Settings（或 Emails / SMTP）**里会有：</p>
<ul data-start="333" data-end="369">
<li data-start="333" data-end="350">
<p data-start="335" data-end="350"><strong data-start="335" data-end="350">Sender name</strong></p>
</li>
<li data-start="351" data-end="369">
<p data-start="353" data-end="369"><strong data-start="353" data-end="369">Sender email</strong></p>
</li>
</ul>
<p data-start="371" data-end="400">把 <strong data-start="373" data-end="389">Sender email</strong> 改成你想固定的地址：</p>
<ul data-start="401" data-end="433">
<li data-start="401" data-end="433">
<p data-start="403" data-end="433"><code data-start="403" data-end="433">jewel@send.update.875538.xyz</code></p>
</li>
</ul>
<blockquote data-start="435" data-end="514">
<p data-start="437" data-end="514">注意：你截图里是 <code data-start="446" data-end="470">send.update.875538.xyz</code>（没有 s），你这条地址也要保持一致：<code data-start="489" data-end="514">@send.update.875538.xyz</code></p>
</blockquote>
<h3 data-start="516" data-end="542">2) 确保 Resend 允许这个 From</h3>
<p data-start="543" data-end="735">只要你在 Resend 验证的是 <code data-start="560" data-end="584">send.update.875538.xyz</code>（或根域 <code data-start="589" data-end="601">875538.xyz</code>），那么 <code data-start="606" data-end="636">jewel@send.update.875538.xyz</code> 这种 From 一般是允许的。<br data-start="652" data-end="655">
如果 Resend 只验证了根域，但你用子域发，也要看你在 Resend 里验证的是哪个域名；最稳是 <strong data-start="706" data-end="734">在 Resend 里验证你实际用来发信的那个域名</strong>。</p>
<h3 data-start="737" data-end="762">3) 你看到“代发”的原因（顺便避免误会）</h3>
<p data-start="763" data-end="877">有的邮箱客户端会显示 “via xxx / 代发”，通常是 <strong data-start="793" data-end="815">DMARC/SPF/DKIM 对不齐</strong> 或者 <strong data-start="819" data-end="838">From 域和实际投递域不一致</strong>导致的提示。你已经加了 SPF/DKIM/DMARC，看起来方向对，但要保证：</p>
<ul data-start="878" data-end="1079">
<li data-start="878" data-end="914">
<p data-start="880" data-end="914">From 用的是 <code data-start="889" data-end="914">@send.update.875538.xyz</code></p>
</li>
<li data-start="915" data-end="985">
<p data-start="917" data-end="985">SPF/DKIM 也是给 <code data-start="930" data-end="954">send.update.875538.xyz</code> 配的（你截图就是配置在 <code data-start="967" data-end="980">send.update</code> 子域上）</p>
</li>
<li data-start="986" data-end="1079">
<p data-start="988" data-end="1079">DKIM 记录名要准确是 <code data-start="1001" data-end="1043">resend._domainkey.send.update.875538.xyz</code>（你界面里可能被截断，最好在 Resend 域名页对照它给的 Host）</p>
</li>
</ul>
<hr data-start="1081" data-end="1084">
<h2 data-start="1086" data-end="1096">最快验证的方法</h2>
<p data-start="1097" data-end="1157">做完后给自己发一封（注册/OTP 邮件），然后在 Gmail/Outlook 里点“查看原始邮件/原文”，看头里是否是：</p>
<ul data-start="1158" data-end="1312">
<li data-start="1158" data-end="1196">
<p data-start="1160" data-end="1196"><code data-start="1160" data-end="1196">From: jewel@send.update.875538.xyz</code></p>
</li>
<li data-start="1197" data-end="1260">
<p data-start="1199" data-end="1260"><code data-start="1199" data-end="1215">DKIM-Signature</code> 是否 <code data-start="1219" data-end="1245">d=send.update.875538.xyz</code>（或 Resend 使用的域）</p>
</li>
<li data-start="1261" data-end="1312">
<p data-start="1263" data-end="1312"><code data-start="1263" data-end="1287">Authentication-Results</code> 里 SPF/DKIM/DMARC 是否 pass</p>
</li>
</ul>
<hr data-start="1314" data-end="1317">
<p data-start="1319" data-end="1360">如果你告诉我两件事，我可以直接定位你现在为什么会出现随机 <code data-start="1348" data-end="1359">xxxxx@...</code>：</p>
<ol data-start="1361" data-end="1466">
<li data-start="1361" data-end="1403">
<p data-start="1364" data-end="1403">你 Supabase 里 <strong data-start="1377" data-end="1393">Sender email</strong> 现在填的是什么</p>
</li>
<li data-start="1404" data-end="1466">
<p data-start="1407" data-end="1466">你 Resend 里验证的是 <strong data-start="1422" data-end="1436">875538.xyz</strong> 还是 <strong data-start="1440" data-end="1466">send.update.875538.xyz</strong></p>
</li>
</ol>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">但是resend中验证的域名是updates.875538.xyz</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="103">明白了：你在 Resend 里验证的是 <strong data-start="20" data-end="44"><code data-start="22" data-end="42">updates.875538.xyz</code></strong>，而你现在邮件里出现的是 <strong data-start="57" data-end="92"><code data-start="59" data-end="90">xxxxx@send.updates.875538.xyz</code></strong>。这里面有两个关键点：</p>
<h2 data-start="105" data-end="155">1) 你看到的 <code data-start="116" data-end="139">xxxxx@send.updates...</code> 很可能不是“发件人 From”</h2>
<p data-start="156" data-end="175">很多邮件客户端/原始邮件里会同时出现：</p>
<ul data-start="177" data-end="315">
<li data-start="177" data-end="220">
<p data-start="179" data-end="220"><strong data-start="179" data-end="192">From（发件人）</strong>：收件人“看到是谁发的”，你想固定成 <code data-start="211" data-end="220">jewel@…</code></p>
</li>
<li data-start="221" data-end="315">
<p data-start="223" data-end="315"><strong data-start="223" data-end="260">Return-Path / Envelope-From（退信地址）</strong>：用来处理退信/回执，常常是 <strong data-start="275" data-end="283">随机前缀</strong>（<code data-start="284" data-end="307">xxxxx@send.updates...</code> 这种非常常见）</p>
</li>
</ul>
<p data-start="317" data-end="411">所以你现在看到的“代发 <code data-start="329" data-end="352">xxxxx@send.updates...</code>”，<strong data-start="354" data-end="366">大概率是退信地址</strong>，它本来就不建议固定，也通常不能固定成一个简单邮箱（因为要区分投递/退信、做反滥用追踪）。</p>
<p data-start="413" data-end="442">✅ 你能控制并让用户界面固定展示的，是 <strong data-start="433" data-end="441">From</strong>。</p>
<hr data-start="444" data-end="447">
<h2 data-start="449" data-end="482">2) 要让 From 固定为 <code data-start="467" data-end="478">jewel@...</code>，这样配</h2>
<p data-start="483" data-end="526">既然 Resend 验证的是 <code data-start="498" data-end="518">updates.875538.xyz</code>，最稳的做法是：</p>
<h3 data-start="528" data-end="570">在 Supabase 里把 Sender email 改成（固定 From）</h3>
<ul data-start="571" data-end="670">
<li data-start="571" data-end="670">
<p data-start="573" data-end="670"><strong data-start="573" data-end="603"><code data-start="575" data-end="601">jewel@updates.875538.xyz</code></strong>  ✅（推荐）<br>
而不是 <code data-start="615" data-end="646">jewel@send.updates.875538.xyz</code>（这属于更深一层子域名，除非你也单独验证过它）。</p>
</li>
</ul>
<p data-start="672" data-end="687">Supabase 路径一般在：</p>
<ul data-start="688" data-end="786">
<li data-start="688" data-end="786">
<p data-start="690" data-end="786"><strong data-start="690" data-end="744">Authentication → Emails（或 Settings）→ SMTP / Sender</strong><br data-start="744" data-end="747">
把 <strong data-start="749" data-end="780">Sender email / From address</strong> 改掉即可。</p>
</li>
</ul>
<blockquote data-start="788" data-end="841">
<p data-start="790" data-end="841">只要 From 在你验证过的域名下（<code data-start="808" data-end="829">@updates.875538.xyz</code>），投递和显示会最稳定。</p>
</blockquote>
<hr data-start="843" data-end="846">
<h2 data-start="848" data-end="893">3) 如果你坚持要用 <code data-start="862" data-end="893">jewel@send.updates.875538.xyz</code></h2>
<p data-start="894" data-end="1022">那就做一件事：<strong data-start="901" data-end="949">在 Resend 里再新增并验证域名 <code data-start="922" data-end="947">send.updates.875538.xyz</code></strong>（单独一条域名验证），然后在 Supabase 的 Sender email 填 <code data-start="990" data-end="1021">jewel@send.updates.875538.xyz</code>。</p>
<hr data-start="1024" data-end="1027">
<h2 data-start="1029" data-end="1068">4) 如果你说的是 Gmail 显示 “via resend / 代发”</h2>
<p data-start="1069" data-end="1174">即使 From 固定了，Gmail 仍可能显示 “via …”，通常是因为 **SPF/DKIM/DMARC 对齐（alignment）**没通过或不够“匹配”。这时你要检查邮件原文里这几项是否 <code data-start="1167" data-end="1173">pass</code>：</p>
<ul data-start="1175" data-end="1216">
<li data-start="1175" data-end="1185">
<p data-start="1177" data-end="1185">SPF pass</p>
</li>
<li data-start="1186" data-end="1197">
<p data-start="1188" data-end="1197">DKIM pass</p>
</li>
<li data-start="1198" data-end="1216">
<p data-start="1200" data-end="1216">DMARC pass（对齐通过）</p>
</li>
</ul>
<p data-start="1218" data-end="1274">如果你愿意，你把那封邮件的 **“显示原始邮件 / Show original”**里这几行贴出来（打码也行）：</p>
<ul data-start="1275" data-end="1404">
<li data-start="1275" data-end="1286">
<p data-start="1277" data-end="1286"><code data-start="1277" data-end="1284">From:</code></p>
</li>
<li data-start="1287" data-end="1305">
<p data-start="1289" data-end="1305"><code data-start="1289" data-end="1303">Return-Path:</code></p>
</li>
<li data-start="1306" data-end="1335">
<p data-start="1308" data-end="1335"><code data-start="1308" data-end="1333">Authentication-Results:</code></p>
</li>
<li data-start="1336" data-end="1404">
<p data-start="1338" data-end="1404"><code data-start="1338" data-end="1355">DKIM-Signature:</code><br data-start="1355" data-end="1358">
我可以一眼告诉你：现在到底是 <strong data-start="1373" data-end="1385">From 没设对</strong>，还是 <strong data-start="1389" data-end="1397">对齐没过</strong>导致“代发”。</p>
</li>
</ul>
</div></div>
<div class="message-block role-user"><div class="message-role">Jewel</div><div class="message-content">我的意思是，我已经写成了jewel@updates.875538.xyz，但是对方收到邮件是：
发件人： jewel@updates.875538.xyz （由xxxxxxxxx@send.updates.875538.xyz代发）</div></div>
<div class="message-block role-ai"><div class="message-role">AI</div><div class="message-content"><p data-start="0" data-end="140">你这个现象<strong data-start="5" data-end="13">非常正常</strong>：你把 <strong data-start="17" data-end="25">From</strong> 设成了 <code data-start="30" data-end="56">jewel@updates.875538.xyz</code>，但 Resend（底层用 SES）还会在每封信里放一个用于<strong data-start="86" data-end="97">退信/投诉回传</strong>的 <strong data-start="99" data-end="133">Return-Path / MAIL FROM（信封发件人）</strong>，通常长这样：</p>
<ul data-start="142" data-end="258">
<li data-start="142" data-end="185">
<p data-start="144" data-end="185">From（用户看到的发件人）：<code data-start="159" data-end="185">jewel@updates.875538.xyz</code></p>
</li>
<li data-start="186" data-end="258">
<p data-start="188" data-end="258">Return-Path / MAIL FROM（系统用来收退信的地址）：<code data-start="224" data-end="258">xxxxxxxx@send.updates.875538.xyz</code></p>
</li>
</ul>
<p data-start="260" data-end="452">很多邮箱客户端会把它显示成“<strong data-start="274" data-end="310">由 <a data-start="278" data-end="305" class="decorated-link cursor-pointer" rel="noopener">xxx@send.updates.875538.xyz<span aria-hidden="true" class="ms-0.5 inline-block align-middle leading-none"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" data-rtl-flip="" class="block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#304883" fill="currentColor"></use></svg></span></a> 代发</strong> / via …”。Resend 也明确：发送时需要在 <code data-start="338" data-end="359">send.yourdomain.com</code> 这种子域名上配置 MX，用来建立 return-path，且它会被写进邮件头里（有些客户端会暴露给收件人）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/docs/knowledge-base/how-do-i-avoid-conflicting-with-my-mx-records?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/docs/knowledge-base/how-do-i-avoid-conflicting-with-my-mx-records?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
<h3 data-start="454" data-end="474">能不能改成你想要的“固定显示”？</h3>
<p data-start="475" data-end="480">分两件事：</p>
<h4 data-start="482" data-end="523">1) “发件人显示为 <a data-start="498" data-end="522" class="decorated-link cursor-pointer" rel="noopener">jewel@updates.875538.xyz<span aria-hidden="true" class="ms-0.5 inline-block align-middle leading-none"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" data-rtl-flip="" class="block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#304883" fill="currentColor"></use></svg></span></a>”</h4>
<p data-start="524" data-end="547">✅ 这个你已经做到了（From 是你想要的）。</p>
<h4 data-start="549" data-end="610">2) “代发那一串 <a data-start="564" data-end="585" class="decorated-link cursor-pointer" rel="noopener">xxxxxxxx@send.updates<span aria-hidden="true" class="ms-0.5 inline-block align-middle leading-none"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" data-rtl-flip="" class="block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#304883" fill="currentColor"></use></svg></span></a>… 能不能变成 jewel@… 或固定某个前缀？”</h4>
<p data-start="611" data-end="625">基本 <strong data-start="614" data-end="624">不能也不建议</strong>：</p>
<ul data-start="626" data-end="895">
<li data-start="626" data-end="694">
<p data-start="628" data-end="694">那个 <code data-start="631" data-end="641">xxxxxxxx</code> 前缀通常是服务商用来追踪投递/退信/投诉的标识（不同邮件/收件人可能不同），不是给人看的“发件人”。</p>
</li>
<li data-start="695" data-end="895">
<p data-start="697" data-end="895">你通常只能改 <strong data-start="704" data-end="722"><code data-start="706" data-end="712">send</code> 这个子域名前缀</strong>（比如改成 <code data-start="728" data-end="734">mail</code>/<code data-start="735" data-end="743">bounce</code>），而不是改每封信的本地部分 <code data-start="758" data-end="768">xxxxxxxx</code>。Resend 提供了 <strong data-start="780" data-end="802">Custom Return Path</strong>，就是让你把默认的 <code data-start="812" data-end="818">send</code> 子域改成你自定义的子域名（并提醒这可能会被部分客户端暴露，所以别用尴尬词）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/changelog/custom-return-path?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/changelog/custom-return-path?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span></p>
</li>
</ul>
<hr data-start="897" data-end="900">
<h2 data-start="902" data-end="924">如果你想“看起来更正常”，推荐做这两步</h2>
<h3 data-start="926" data-end="968">A) 把 Return-Path 子域从 <code data-start="951" data-end="957">send</code> 改成更好看的（可选）</h3>
<p data-start="969" data-end="1182">在 Resend 里给 <code data-start="981" data-end="1001">updates.875538.xyz</code> 开 <strong data-start="1004" data-end="1026">Custom Return Path</strong>，把 <code data-start="1029" data-end="1035">send</code> 改成比如 <code data-start="1041" data-end="1047">mail</code> 或 <code data-start="1050" data-end="1058">bounce</code>（最终会变成 <code data-start="1065" data-end="1090">mail.updates.875538.xyz</code>）。<span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 61px;"><a href="https://resend.com/changelog/custom-return-path?utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://resend.com/changelog/custom-return-path?utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 61px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Resend</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span><br data-start="1129" data-end="1132">
然后按 Resend 新给你的 DNS 记录（通常是该子域的 MX + SPF TXT）重新配一遍。</p>
<blockquote data-start="1184" data-end="1220">
<p data-start="1186" data-end="1220">这只能让“代发”里域名更好看，<code data-start="1201" data-end="1212">xxxxxxxx@</code> 一般仍会存在。</p>
</blockquote>
<h3 data-start="1222" data-end="1259">B) 确保 DMARC 对齐通过，减少 “via/代发” 警告概率</h3>
<p data-start="1260" data-end="1462">“via/代发”经常和 **认证域不一致（SPF/DKIM/DMARC alignment）**有关。Google 的 DMARC 说明里讲得很清楚：DMARC 看的是 <strong data-start="1345" data-end="1355">From 域</strong>与 SPF（MAIL FROM）或 DKIM（d=）域的匹配程度（alignment）。 <span class="" data-state="closed"><span class="ms-1 inline-flex max-w-full items-center relative top-[-0.094rem] animate-[show_150ms_ease-in]" data-testid="webpage-citation-pill" style="width: 82px;"><a href="https://support.google.com/a/answer/2466580?hl=en&amp;utm_source=chatgpt.com" target="_blank" rel="noopener" alt="https://support.google.com/a/answer/2466580?hl=en&amp;utm_source=chatgpt.com" class="flex h-4.5 overflow-hidden rounded-xl px-2 text-[9px] font-medium transition-colors duration-150 ease-in-out text-token-text-secondary! bg-[#F4F4F4]! dark:bg-[#303030]!" style="max-width: 82px;"><span class="relative start-0 bottom-0 flex h-full w-full items-center"><span class="flex h-4 w-full items-center justify-between" style="opacity: 1; transform: none;"><span class="max-w-[15ch] grow truncate overflow-hidden text-center">Google Help</span><span class="-me-1 flex h-full items-center rounded-full px-1 text-[#8F8F8F]">+1</span></span></span></a></span></span><br data-start="1437" data-end="1440">
你要确保收件箱里这几个都 <strong data-start="1453" data-end="1461">pass</strong>：</p>
<ul data-start="1463" data-end="1600">
<li data-start="1463" data-end="1507">
<p data-start="1465" data-end="1507"><code data-start="1465" data-end="1476">dkim=pass</code> 且 <code data-start="1479" data-end="1501">d=updates.875538.xyz</code>（或其子域）</p>
</li>
<li data-start="1508" data-end="1585">
<p data-start="1510" data-end="1585"><code data-start="1510" data-end="1520">spf=pass</code> 且 <code data-start="1523" data-end="1562">smtp.mailfrom=send.updates.875538.xyz</code>（或你自定义的 return path 子域）</p>
</li>
<li data-start="1586" data-end="1600">
<p data-start="1588" data-end="1600"><code data-start="1588" data-end="1600">dmarc=pass</code></p>
</li>
</ul>
<hr data-start="1602" data-end="1605">
<h2 data-start="1607" data-end="1640">我建议你发我一小段邮件原文，我就能精确判断能不能“去掉代发”</h2>
<p data-start="1641" data-end="1695">在 Gmail/Outlook 里打开那封信的“显示原始邮件/查看邮件头”，把下面几行贴出来（打码没关系）：</p>
<ul data-start="1696" data-end="1770">
<li data-start="1696" data-end="1705">
<p data-start="1698" data-end="1705"><code data-start="1698" data-end="1705">From:</code></p>
</li>
<li data-start="1706" data-end="1722">
<p data-start="1708" data-end="1722"><code data-start="1708" data-end="1722">Return-Path:</code></p>
</li>
<li data-start="1723" data-end="1750">
<p data-start="1725" data-end="1750"><code data-start="1725" data-end="1750">Authentication-Results:</code></p>
</li>
<li data-start="1751" data-end="1770">
<p data-start="1753" data-end="1770"><code data-start="1753" data-end="1770">DKIM-Signature:</code></p>
</li>
</ul>
<p data-start="1772" data-end="1844">我可以直接告诉你：你现在的“代发”是<strong data-start="1790" data-end="1809">纯 UI 显示（正常不可消除）</strong>，还是因为 <strong data-start="1815" data-end="1833">DKIM/DMARC 没对齐</strong>导致的“警告式代发”。</p>
</div></div>